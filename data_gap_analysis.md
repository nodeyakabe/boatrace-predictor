# データ不足項目の状況整理

## 現在のデータカバレッジ（開催完走レースのみ）
- 総完走レース数: 30,762件
- 事前情報: 25,827件/30,762件 = **84.0%**

### 詳細データ（エントリベース: 184,572件）
- 進入コース: 141,774件 = **76.8%**
- STタイム: 118,606件 = **64.3%**
- 展示タイム: 152,105件 = **82.4%**
- チルト角度: 152,106件 = **82.4%**

---

## 不足データ項目の状況

### 🔵 現在収集中（進行中のスクリプトで補完される）

| 項目 | 重要度 | 現在の充足率 | 収集後の予想充足率 | 状況 |
|------|--------|-------------|-------------------|------|
| 進入コース | ★★★★ | 76.8% | **100%** | `missing_details.csv`から6,894レース分を収集中（進捗: 約600件完了） |
| 展示タイム | ★★★ | 82.4% | **100%** | 同上 |
| STタイム | ★★★ | 64.3% | **100%** | 同上 |
| チルト角度 | ★★ | 82.4% | **100%** | 同上 |

**進捗状況:** バックグラウンドで `fetch_missing_data.py` が8ワーカーで並列実行中。
- 対象: 6,894レース分の事前情報（race_details）
- 完了: 約600件
- 残り: 約6,200件（推定あと1-2時間で完了）

---

### 🟡 既存データから計算可能（スクレイピング不要）

| 項目 | 重要度 | 現在の充足率 | 実装方法 |
|------|--------|-------------|---------|
| 三連単オッズ | ★★★ | 78.1% | 既存の`payouts`テーブルから取得済み |

**状況:** オッズデータは結果ページからスクレイピング済み。追加収集は不要。

---

### 🔴 未着手（新規スクレイピングが必要）

| 項目 | 重要度 | 現在の充足率 | 必要な作業 |
|------|--------|-------------|-----------|
| 決まり手 | ★★★★ | 16.3% | 結果ページのスクレイピング強化が必要 |
| 潮位 | ★★★★ | 50.0% | 潮汐APIの実装が必要 |
| 潮流方向・速度 | ★★★★ | 0.0% | 潮汐APIの実装が必要 |

---

## データ収集の優先順位

### 優先度1（現在実行中）: レース詳細情報
- ✅ **実行中**: `fetch_missing_details.py`で事前情報を収集中
- 対象データ: 進入コース、ST・展示タイム、チルト角度
- 完了予定: 1-2時間後

### 優先度2（次のステップ）: 決まり手データ
- ❌ **未着手**: 結果ページのスクレイピング強化
- 現在16.3%しか取得できていない
- 対策:
  1. `ResultScraper`の決まり手抽出ロジックを確認
  2. 取得失敗している理由を調査（HTMLパターンの変化？）
  3. 欠損している24,000レース分を再スクレイピング

### 優先度3（長期的課題）: 潮汐データ
- ❌ **未着手**: 外部API連携が必要
- 潮位: 50%（気象庁APIなどから取得可能）
- 潮流: 0%（取得元が不明、データソースの調査が必要）
- 機械学習には有用だが、まずは基本データ（優先度1-2）を完成させるべき

---

## 次のアクション

### すぐにできること
1. ✅ **待機**: 現在の事前情報収集（6,894件）を完了させる
2. ⏳ **準備**: 決まり手データの調査
   - `ResultScraper.get_race_result()`で決まり手の取得ロジックを確認
   - 取得失敗しているレースのHTMLサンプルを取得して解析

### 今後の対応
3. 🔧 **実装**: 決まり手の再スクレイピング
4. 🔧 **実装**: 潮汐API連携（時間があれば）

---

## まとめ

**現在実行中の収集が完了すれば:**
- 進入コース: 76.8% → 100% ✅
- STタイム: 64.3% → 100% ✅
- 展示タイム: 82.4% → 100% ✅
- チルト角度: 82.4% → 100% ✅

**残りの主要課題:**
- 決まり手: 16.3% → 要改善（重要度★★★★）
- 潮汐データ: 未実装（重要度★★★★だが外部API必要）
