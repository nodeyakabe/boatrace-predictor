
# 競艇予想ツール 改善ポイントまとめ

## 🔴 最優先（ROIに直結）

### ① 特徴量の欠落（pit_number が無い問題）
競艇モデルでコース番号が無いのは致命的。

**改善案**
- pit_number をカテゴリ変数として追加
- 新モデル v2 をフル再学習
- SHAPで特徴量重要度を確認

### ② 展示データの圧倒的不足（951件しか無い）
展示データが少ないためノイズ扱いになる。

**改善案**
- 毎日20時にスクレイパーで展示データ取得
- 過去2年ぶんを後追い収集

### ③ 条件付きモデルの構造が弱い
2着モデルに1着モデルの予測が伝搬していない。

**改善案**
- 2着モデルに「1着予測確率」を追加
- 3着モデルも同じ構造へ

---

## 🟠 高優先度（性能・精度を安定化）

### ④ 全モデルに確率校正が必要
段階予測では確率が歪むので校正が必須。

### ⑤ 評価指標がAUCに偏っている
順位予測ではより多くの指標が必要。

**追加すべき指標**
- Brier score
- Logloss
- Rank correlation
- Top-N Accuracy

### ⑥ 三連単120通りの確率が合計1にならない
段階モデルでは合計1が保証されない。

**改善案**
- 最後に softmax 正規化
- または Dirichlet補正

---

## 🟡 中優先度（システムの安定性）

### ⑦ スクレイパー例外処理の統一
戻り値フォーマットを統一する。

### ⑧ SQLインデックス不足
race_date, venue_code, race_number に複合インデックスを追加。

---

## 🟢 低優先度（整備系）

### ⑨ ファイル構成の最適化
整理されたプロジェクト構造へ。

### ⑩ ドキュメントが多すぎる
概要ドキュメント＋リンク集を作成。

---

## 🎯 最優先TODO
1. pit_number を追加しモデル再学習
2. 展示データの自動収集
3. 条件付きモデルの構造改善
4. 全モデル確率校正
5. 三連単確率の正規化
