# 🚤 競艇予想システム 開発指示書（設計仕様書）

## 🎯 プロジェクト概要
全国24競艇場のデータを自動取得し、  
その日の「おすすめレース」や「三連単の買い目」を抽出・表示する自分用予想支援ツールを構築する。  

第一段階では、データ収集とUIの土台を整えることを目的とする。  

---

## 🧩 システム全体構成（概要）

### 1️⃣ データ収集層（スクレイピング / API）
- **取得対象**
  - 競艇公式サイト（出走表、選手、モーター情報、オッズ、結果）
  - 天候（風速・風向・気温・天気）
  - 潮汐（満潮・干潮・潮位）

- **取得方法**
  - `requests` + `BeautifulSoup` によるスクレイピング
  - 公開API（気象庁、OpenWeatherMap、海上保安庁 など）
  - 全24競艇場を対象（競艇場コード or 名前を持つリストでループ）

- **更新頻度**
  - 毎日午前6時に自動実行（cronジョブ or Pythonのscheduler）
  - 各データをローカルDBに保存

### 2️⃣ データベース層
- **DB種別**：SQLite（初期段階）→ 将来は PostgreSQL などへ拡張可能  
- **主要テーブル**
  - `races`（日付・場名・レース番号・出走時間など）
  - `entries`（選手情報・モーター番号・進入コースなど）
  - `weather`（気温・風向・風速・天気）
  - `tide`（満潮・干潮・潮位）
  - `results`（確定情報・三連単オッズ）

---

## 🧠 データ処理・ロジック層

- **目的**
  - 収集したデータを元に「おすすめレース」を抽出
  - 条件フィルタ例：
    - 風速○m以下
    - 潮が上げ潮のタイミング
    - 1号艇の勝率が高いレース
  - 条件のパラメータは後から追加できるよう設計

- **出力**
  - 「おすすめレースTOP5」
  - 「三連単買い目候補（3点〜5点）」
  - 「信頼度（0〜100%）」

---

## 🖥 UI（フロントエンド）

- **フレームワーク**：`Streamlit`（Pythonのみで構築可能）
- **画面構成**
  1. トップページ：日付選択＋全場リスト
  2. レース詳細ページ：出走表＋天気＋潮＋買い目
  3. おすすめレース一覧：AI選定結果を表示

- **表示形式**
  - テーブル表示（Pandas DataFrame）
  - グラフ（matplotlib or plotly）
  - 条件フィルタUI（スライダー・セレクトボックス）

---

## ⚙️ 開発技術スタック

| 分類 | 使用予定技術 |
|------|---------------|
| 言語 | Python 3.10以上 |
| Web UI | Streamlit |
| データ取得 | requests, BeautifulSoup4, API通信 |
| データ整形 | pandas, datetime |
| DB | SQLite（sqlite3） |
| 自動実行 | schedule または cron |
| 将来拡張 | FastAPI, React, 機械学習モデル（scikit-learn） |

---

## 📂 ディレクトリ構成（推奨）

```
boatrace_predictor/
├── data/                # 保存用CSVやDB
├── src/
│   ├── scraper/
│   │   ├── race_scraper.py
│   │   ├── weather_scraper.py
│   │   └── tide_scraper.py
│   ├── database.py
│   ├── analyzer.py      # データ分析・ロジック
│   └── recommender.py   # おすすめレース抽出ロジック
├── ui/
│   └── app.py           # Streamlitメイン画面
├── config/
│   └── settings.yaml    # APIキー・URL・場リストなど
└── main.py              # 全体実行スクリプト
```

---

## 🚀 初期開発ステップ

1. **環境構築**
   - Python環境準備  
   - ライブラリ導入  
     ```bash
     pip install requests beautifulsoup4 pandas streamlit schedule
     ```

2. **出走表スクレイピングの実装**
   - 公式サイトから「今日の出走表」を取得
   - テーブルデータをCSVまたはSQLiteに保存

3. **天気・潮データAPI取得**
   - 競艇場ごとの緯度経度リストを作成
   - APIキーを設定して毎日自動取得

4. **Streamlit UI実装**
   - 日付を指定して出走表＋天候＋潮を表示する画面を作成

5. **レース抽出ロジック**
   - 仮の条件で「おすすめレース」を抽出
   - 後からAIや学習モデル導入可能に

---

## 📈 将来的な拡張（第二段階）

- 学習モデル導入（選手・モーター・天候・潮の相関分析）
- 自動買い目生成（確率上位を抽出）
- オッズとの乖離を見た「妙味判定」
- LINE通知やメール送信
