# 🗺️ 開発ロードマップ

## 📊 現在の状況（v0.4.0）

### ✅ 完成している機能

1. **データ取得基盤**
   - 出走表スクレイピング（全23項目）
   - レース結果スクレイピング（着順・オッズ）
   - 過去データ一括取得（期間指定）
   - 重複防止機能

2. **統計分析機能**
   - コース別勝率分析（競艇場ごと）
   - 全国平均との比較
   - 傾向の自動言語化
   - 統計的有意性判定

3. **総合予想スコアリング**
   - コーススコア（最大40点）
   - 選手スコア（最大40点）
   - モータースコア（最大20点）
   - 信頼度5段階評価

4. **期待値計算機能**
   - オッズデータ取得
   - 的中確率推定
   - 期待値自動計算
   - プラス期待値の買い目抽出

5. **UI機能**
   - レース一覧表示
   - 過去データ取得（プログレスバー付き）
   - 統計分析タブ（グラフ表示）
   - 設定管理

---

## ⏸️ 保留中の機能

### 1. 天気データ連携
**状態**: APIキー有効化待ち（2-3時間）

**理由**: OpenWeatherMap APIキー（1ff6c14c3416cf861c4d06b1b9de5913）が未承認

**完了後の作業**:
- weather_scraperの動作確認
- 天候要因の分析追加（晴れ・雨・風速）
- 統計分析への天候要因統合

---

### 2. おすすめレース抽出ロジック
**状態**: 条件吟味中（後回し）

**理由**: ユーザー要望「一旦後回しだ なんなら最後でもいい」

**必要な検討事項**:
- どのような条件でレースを推奨するか
  - 例1: 信頼度が高く、期待値がプラス
  - 例2: 本命が固い（1位のスコアが突出）
  - 例3: 混戦模様（荒れるレース）
- 1日のレース数の目安（3レース？5レース？）
- 推奨買い目の点数制限

---

### 3. オッズスクレイパーの精度検証
**状態**: 実装済み、HTMLパース未検証

**理由**: 実際のオッズページでテストしていない

**必要な作業**:
- 実際のレースでオッズ取得テスト
- HTMLパースロジックの調整
- エラーハンドリング強化

---

### 4. 潮汐データ取得・分析
**状態**: 未着手

**理由**: 優先度低（まずは基本的な分析を完成させる）

**潮汐の影響**:
- 満潮時: インコースが有利？
- 干潮時: アウトコースが有利？
- 統計的な相関を分析

**データソース候補**:
- 気象庁の潮汐データ
- 競艇公式サイトの潮汐情報

---

## 🎯 今後の開発方向性

### フェーズ1: データ蓄積期間（現在～1ヶ月）

**目標**: まず過去データを蓄積する

1. **複数競艇場のデータ取得**
   - 芦屋、若松、福岡（福岡県内3場）
   - 各競艇場3ヶ月分のデータ

2. **データ品質の確認**
   - 欠損データのチェック
   - スクレイピング精度の検証
   - エラーログの分析

3. **統計分析の精度向上**
   - サンプル数による信頼性判定
   - 季節性の考慮（夏・冬で傾向が変わる？）

---

### フェーズ2: 予想精度の検証（1-2ヶ月後）

**目標**: 実際に当たるか検証する

1. **バックテスト機能**
   - 過去のレースで予想を実行
   - 的中率を集計
   - スコアリングの重み調整

2. **予想精度の可視化**
   - 的中率の推移グラフ
   - 期待値の実績比較
   - 競艇場ごとの精度差

3. **モデルの改良**
   - スコア配分の最適化
   - 新たな要因の追加（天候、潮汐など）

---

### フェーズ3: 実運用・買い目提示（2-3ヶ月後）

**目標**: 実際の舟券購入に使える水準に

1. **おすすめレース自動抽出**
   - 信頼度スコア閾値
   - 期待値フィルタ
   - 1日3-5レースに絞る

2. **買い目提示の詳細化**
   - 3連単（1点予想、フォーメーション、BOX）
   - 3連複（鉄板、BOX）
   - 2連単・2連複
   - 購入金額の推奨配分

3. **収支管理機能**
   - 購入履歴の記録
   - 収支グラフ
   - ROI（投資利益率）計算

---

### フェーズ4: 全国展開（3ヶ月後～）

**目標**: 全24競艇場に対応

1. **競艇場コードの網羅**
   - 全24場のコード調査
   - settings.pyへの登録

2. **競艇場ごとの特性データベース**
   - コース別傾向
   - 水面特性（静水面・うねり）
   - 季節による変化

3. **全国統計の比較**
   - 競艇場ランキング（的中しやすい場）
   - 地域性の分析

---

## 🔧 技術的な改善項目

### 優先度: 高

1. **エラーハンドリングの強化**
   - ネットワークエラー時のリトライ
   - HTMLパース失敗時のフォールバック
   - ログ出力の整備

2. **パフォーマンス最適化**
   - データベースインデックスの追加
   - SQL最適化
   - キャッシュ機構

3. **データ検証機能**
   - データ整合性チェック
   - 異常値検出
   - 自動修正

### 優先度: 中

4. **UI/UX改善**
   - レスポンシブデザイン
   - ダークモード
   - カスタマイズ機能

5. **通知機能**
   - おすすめレース発見時の通知
   - データ取得完了通知
   - エラー通知

6. **エクスポート機能**
   - CSV出力
   - PDFレポート生成
   - Excel連携

### 優先度: 低

7. **機械学習モデル導入**
   - LightGBM/XGBoostでの予想
   - ニューラルネットワーク
   - アンサンブル学習

8. **モバイルアプリ化**
   - スマホ対応UI
   - プッシュ通知

---

## 💡 ユーザー要望の整理

### 明確な要望

1. **過去データの蓄積**
   > 「あればあるだけ精度があがる」
   - ✅ 実装済み（historical_scraper.py）

2. **傾向と確率の言語化**
   > 「若松は4コースの勝率がほかの場より高いので1着率10パーセントアップ」
   - ✅ 実装済み（insight_generator.py）

3. **期待値・信頼度の提示**
   > 「期待値や信頼度を出す」
   - ✅ 実装済み（race_predictor.py）

### 保留・検討中

4. **おすすめレース抽出**
   > 「一旦後回しだ なんなら最後でもいい」
   - ⏸️ フェーズ3で実装予定

5. **環境要因の分析**
   > 「干潮の時はインコースの三連対率10パーセント上昇」
   - ⏸️ 潮汐データ取得後に実装

---

## 📅 マイルストーン

### M1: データ基盤完成（✅ 完了）
- データベース設計
- スクレイピング機能
- 過去データ取得

### M2: 統計分析完成（✅ 完了）
- コース別分析
- 言語化エンジン
- 統計サマリー

### M3: 予想機能完成（✅ 完了）
- スコアリング
- 期待値計算
- 買い目推奨

### M4: データ蓄積（🔄 進行中）
- 複数競艇場のデータ取得
- 3ヶ月分の履歴蓄積

### M5: 精度検証（⏳ 待機中）
- バックテスト実装
- 的中率測定
- モデル改良

### M6: 実運用開始（⏳ 待機中）
- おすすめレース抽出
- 収支管理
- レポート出力

---

## 🎓 学習・改善ポイント

### 技術面

1. **HTMLパースの堅牢性**
   - 複数のフォールバック手法
   - 定期的な構造変更への対応

2. **統計手法の妥当性**
   - サンプルサイズの考慮
   - 信頼区間の計算

3. **予想アルゴリズムの精度**
   - 重み付けの最適化
   - 過学習の防止

### ドメイン知識

1. **競艇のルール・特性**
   - ST（スタートタイミング）の重要性
   - モーター抽選の影響期間
   - 気象条件の影響度

2. **統計的な有意性**
   - どの程度のサンプル数で信頼できるか
   - 季節性の考慮

---

**最終更新**: 2025-10-29
