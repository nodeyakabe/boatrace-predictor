# 信頼度別問題点分析レポート

**作成日**: 2025年12月8日
**目的**: 買い目最適化のための現状課題の洗い出しと改善方向性の策定

---

## エグゼクティブサマリー

### 主要な発見

1. **信頼度B**: 1着的中率54%と高精度だが、**3連単データ不足で検証困難**
2. **信頼度C**: 1着予想の**78.7%が1コース**（イン偏重が顕著）
3. **信頼度D**: A1級23.2%のみ、**B1級48.2%と中穴寄り**だが活用できていない
4. **荒れパターン**: 2-6コースからB1級選手が勝利すると**平均2-5万円の高配当**

### 緊急課題

- **現状ロジックはA,B（鉄板）を出すために設計**されている
- **C,D（中穴）は副産物**で専用ロジックが存在しない
- **市場との乖離を検出する仕組みがない**

---

## 1. 信頼度B 問題点詳細

### 1-1. 基本統計

| 指標 | 値 | 備考 |
|------|-----|------|
| 総レース数 | 259件 | 全体の約2.4% |
| 1着的中率 | **54.00%** (81/150) | 非常に高精度 |
| 3連単的中率 | **0.00%** (0/1) | **サンプル不足** |

### 1-2. 問題点

#### (1) サンプル数の極端な少なさ
- 3連単予想が揃っているレースが**たった1件のみ**
- バックテストでの検証が不可能
- 統計的信頼性が皆無

#### (2) オッズ分布の偏り
- オッズ付きレース: わずか1件（12.5倍）
- **低配当レースのみ**が残っている可能性

#### (3) 1コース選手のランク分布
| ランク | 件数 |
|--------|------|
| A1 | 169件 (56.5%) |
| A2 | 89件 (29.7%) |
| B1 | 34件 (11.4%) |
| B2 | 4件 (1.3%) |

→ **A1,A2で86.2%を占める** = 鉄板レース中心

### 1-3. 根本原因

**現在の購入条件（bet_target_evaluator.py）**:
```python
EXCLUDED_CONFIDENCE = ['A', 'B']  # B予想は全て除外
```

→ **そもそも購入対象として考慮されていない**

### 1-4. 改善方向性

#### 短期施策
1. **2連単への転換**
   - 1着的中率54%を活かす
   - 3連単より的中率が高く、サンプル確保可能

2. **Bフィルタの見直し**
   - 全除外 → 条件付き採用へ
   - 例: オッズ15倍以上のみ、など

#### 中長期施策
1. **B専用の買い目生成ロジック**
   - 1着固定の2連単・2連複
   - 複数点買いで的中率向上

2. **信頼度B+のサブカテゴリ作成**
   - B予想の中でも特に確度の高いもの
   - 払戻金が見込めるケースを選別

---

## 2. 信頼度C,D ロジック偏り分析

### 2-1. 信頼度C の特徴

#### (1) コース偏重が極端
| コース | 件数 | 比率 | 平均スコア |
|--------|------|------|-----------|
| **1コース** | **599件** | **78.7%** | 66.0 |
| 3コース | 64件 | 8.4% | 68.3 |
| 2コース | 34件 | 4.5% | 65.2 |
| 4コース | 29件 | 3.8% | 68.3 |
| 5コース | 28件 | 3.7% | 71.1 |
| 6コース | 7件 | 0.9% | 61.5 |

→ **約8割が1コース予想** = イン偏重

#### (2) ランク分布
| ランク | 件数 | 比率 |
|--------|------|------|
| A1 | 329件 | 43.2% |
| A2 | 249件 | 32.7% |
| B1 | 175件 | 23.0% |
| B2 | 8件 | 1.1% |

→ **A1,A2で75.9%** = 上位ランク中心

#### (3) オッズ分布
| オッズ範囲 | 件数 | 平均 |
|-----------|------|------|
| ~10倍 | 2件 | 8.6倍 |
| 10~20倍 | 2件 | 13.1倍 |
| 20~30倍 | 7件 | 23.6倍 |
| 30~50倍 | 3件 | 43.6倍 |
| 50~100倍 | 7件 | 74.7倍 |
| 100倍~ | 3件 | 185.7倍 |

→ **低オッズ（20倍未満）が少ない** = データ不足の可能性

### 2-2. 信頼度D の特徴

#### (1) コース分布
| コース | 件数 | 比率 | 平均スコア |
|--------|------|------|-----------|
| **1コース** | **254件** | **68.5%** | 59.1 |
| 3コース | 38件 | 10.2% | 53.3 |
| 2コース | 36件 | 9.7% | 55.4 |
| 4コース | 22件 | 5.9% | 52.2 |
| 5コース | 14件 | 3.8% | 50.7 |
| 6コース | 7件 | 1.9% | 51.2 |

→ **Cより若干マシだが、依然1コース偏重**

#### (2) ランク分布 ← **重要な発見**
| ランク | 件数 | 比率 |
|--------|------|------|
| **B1** | **179件** | **48.2%** |
| A2 | 87件 | 23.5% |
| A1 | 86件 | 23.2% |
| B2 | 19件 | 5.1% |

→ **B1級が最多** = 中穴向きの選手が多い！

#### (3) オッズ分布
| オッズ範囲 | 件数 | 平均 |
|-----------|------|------|
| 10~20倍 | 3件 | 14.2倍 |
| 20~30倍 | 2件 | 24.2倍 |
| 30~50倍 | 4件 | 36.4倍 |
| 50~100倍 | 7件 | 69.5倍 |
| 100倍~ | 5件 | 259.3倍 |

→ **高配当レースが多い** = 中穴に適している

### 2-3. 問題点

**現状ロジックの設計思想**:
- コース有利度（イン強）: 高配点
- 選手ランク（A1強）: 高配点
- モーター・ST: 補助的

→ **鉄板（A,B）を出すための設計**

**C,Dに不利な要素**:
- イン以外のコースは自動的にスコア低下
- B1選手は自動的にスコア低下
- 荒れる条件（風・波・進入変化）の考慮が弱い

---

## 3. 中穴（荒れ）パターンの特徴

### 3-1. コース別の荒れ傾向

#### 2コース勝利
| ランク | 回数 | 平均払戻 |
|--------|------|---------|
| B1 | 7,124回 | **11,495円** |
| A1 | 5,193回 | 6,686円 |
| A2 | 4,984回 | 7,416円 |

#### 3コース勝利
| ランク | 回数 | 平均払戻 |
|--------|------|---------|
| B1 | 5,767回 | **14,708円** |
| A1 | 4,512回 | 7,530円 |
| A2 | 4,378回 | 9,443円 |

#### 4コース勝利
| ランク | 回数 | 平均払戻 |
|--------|------|---------|
| B1 | 4,716回 | **17,651円** |
| A1 | 3,841回 | 9,350円 |
| A2 | 3,632回 | 10,740円 |

#### 5コース勝利
| ランク | 回数 | 平均払戻 |
|--------|------|---------|
| B1 | 2,557回 | **29,484円** |
| A1 | 2,225回 | 14,087円 |
| A2 | 1,919回 | 18,602円 |

#### 6コース勝利
| ランク | 回数 | 平均払戻 |
|--------|------|---------|
| B1 | 1,102回 | **49,586円** |
| A1 | 1,483回 | 18,869円 |
| A2 | 994回 | 29,836円 |

### 3-2. 重要な発見

**B1級 × アウトコース = 超高配当**
- 2コース: 11,495円
- 3コース: 14,708円
- 4コース: 17,651円
- 5コース: 29,484円
- 6コース: **49,586円**

→ **現状ロジックではこのパターンを見逃している**

### 3-3. 荒れやすい会場TOP10

| 会場コード | 高配当レース数 | 平均払戻 |
|-----------|---------------|---------|
| 02（戸田） | 2,402回 | 15,385円 |
| 04（平和島） | 2,106回 | 16,680円 |
| 03（江戸川） | 1,994回 | 15,858円 |
| 08（常滑） | 1,994回 | 20,400円 |
| 06（浜名湖） | 1,948回 | 18,865円 |

→ **attack_patternsDBのupset_rate活用が有効**

### 3-4. 市場との乖離事例

#### 予想的中 × 高配当（3,000円以上）
| 信頼度 | 回数 | 平均払戻 |
|--------|------|---------|
| E | 8回 | 26,648円 |
| B | 19回 | 9,024円 |
| **C** | **87回** | **8,842円** |
| **D** | **54回** | **8,839円** |

→ **C,D で高配当的中が多発している** = 市場が過小評価

---

## 4. 改善方向性

### 4-1. 信頼度B の活用（短期）

#### 施策1: 2連単への転換
```python
# bet_target_evaluator.py に追加
EXACTA_CONDITIONS_B = {
    'B': {
        'c1_rank': ['A1', 'A2'],  # A級限定
        'min_odds': 5.0,  # 最低オッズ
        'max_odds': 15.0,  # 上限オッズ
        'bet_amount': 300,
        'description': '高精度・低配当を2連単で回収',
    }
}
```

#### 施策2: サンプル収集期間の設定
- 2-3ヶ月運用してデータ蓄積
- 3連単的中率の実績確認
- 改善の有無を判定

### 4-2. 信頼度C,D 専用ロジック構築（最優先）

#### 設計思想の転換

**従来（A,B狙い）**:
```
スコア = コース有利度(35) + 選手能力(35) + モーター(20) + ランク(10)
→ イン・A1が自動的に高スコア
```

**新規（C,D専用）**:
```
スコア = 市場乖離度(40) + 荒れ条件(30) + 選手相性(20) + 隠れ実力(10)
→ オッズと実力の差を検出
```

#### 具体的な特徴量

##### (1) 市場乖離度（40点）
- **オッズ人気と実力の差**
  - モデル予想確率 vs 市場確率（オッズから逆算）
  - Edge = (モデル確率 / 市場確率) - 1
  - Edge > 0.15 でボーナス

- **attack_patterns活用**
  - 選手の会場相性（venue_racer_patterns）
  - 会場の荒れ率（venue_attack_patterns.upset_rate）

##### (2) 荒れ条件（30点）
- **風速・風向**
  - 向かい風6m以上 → 差し・まくり有利
  - 追い風5m以上 → イン激強（逆に荒れにくい）

- **進入変化の予兆**
  - 前付け常習者の検出
  - 枠なり率の低い会場

- **潮位・波高**
  - 満潮時のアウト有利
  - 波高2cm以上の荒水面

##### (3) 選手相性（20点）
- **会場別勝率**
  - racer_venue_features活用
  - 得意水面 × アウトコース = 穴候補

- **直近成績トレンド**
  - racer_features の直近5走
  - 調子上昇中のB1選手を評価

##### (4) 隠れ実力（10点）
- **モーター性能（本来の意味で）**
  - 直近3節の成績（motor_features拡張）
  - 優秀モーター × B1選手 = 高評価

- **ST平均・安定性**
  - 0.10-0.15秒の選手を高評価
  - フライング歴は減点

### 4-3. 実装の優先順位

#### Week 1: データ基盤整備
- [ ] attack_patternsデータの構築
  ```python
  db = AttackPatternDB()
  db.build_all_patterns()
  ```
- [ ] 市場確率計算関数（オッズ逆算）
- [ ] Edge計算ロジック

#### Week 2: 中穴スコアラー実装
- [ ] `src/analysis/upset_scorer.py` 新規作成
- [ ] 上記4要素のスコア計算実装
- [ ] 既存RacePredictorとは別系統で動作

#### Week 3: 検証とチューニング
- [ ] 過去データでバックテスト
- [ ] 中穴的中率・ROI確認
- [ ] スコア配点の最適化

---

## 5. Phase Aバックテスト結果

### 5-1. テスト条件
- モード: `edge_test`（Edge計算のみ追加）
- 期間: 2025年11月
- 総レース数: 1,868件

### 5-2. 結果

| 指標 | 値 |
|------|-----|
| 対象レース | 221件 |
| **3連単的中** | **0件** |
| **2連単的中** | **29件** (13.1%) |
| 投資額 | 44,200円 |
| 回収額 | 17,990円 |
| 収支 | **-26,210円** |
| **ROI** | **40.7%** |

### 5-3. 評価

**結果**: ❌ **失敗**
- ROI 40.7% << 目標115%
- 現状のフィルタ条件では購入対象が不適切
- Edge計算だけでは改善不可

**原因**:
1. ベースとなる予想ロジック自体が中穴向きではない
2. C,D専用ロジックが必要

---

## 6. 次のアクション

### 最優先タスク（今週実施）

1. **C,D専用スコアラーの設計**
   - `src/analysis/upset_scorer.py`
   - 市場乖離度・荒れ条件の定義

2. **attack_patternsデータ構築**
   ```bash
   python -c "from src.database.attack_patterns import AttackPatternDB; db = AttackPatternDB(); db.build_all_patterns()"
   ```

3. **バックテストスクリプト作成**
   - 中穴専用ロジックの効果検証

### 中期タスク（来週以降）

4. **信頼度B の2連単転換**
   - EXACTA_CONDITIONS_B 実装
   - サンプル収集運用

5. **UI統合**
   - 中穴スコアの表示
   - 市場乖離度の可視化

---

## 7. 期待効果

### 定量目標

| 指標 | 現状 | 目標 | 備考 |
|------|------|------|------|
| 信頼度C ROI | ? | 125%以上 | 中穴ロジック適用 |
| 信頼度D ROI | ? | 150%以上 | 高配当狙い |
| 信頼度B 的中率 | 54% (1着) | 30% (2連単) | 転換後 |
| 月間利益 | ? | +20,000円 | C,D,B併用 |

---

*作成者: Claude Code*
*最終更新: 2025年12月8日*
