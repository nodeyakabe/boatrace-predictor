# 潮位データ取得方法の調査

## 調査結果

### 1. ボートレース公式サイト
- **レース結果ページ**: 潮位データなし
- **事前情報ページ**: 潮位データなし
- **結論**: 公式サイトには潮位データが公開されていない

### 2. 利用可能な潮位API

#### 2.1 気象庁 潮位観測データ
**URL**: https://www.data.jma.go.jp/gmd/kaiyou/db/tide/suisan/index.php
- **データ**: 実測潮位データ（過去データ）
- **観測地点**: 全国の主要港湾
- **問題点**:
  - APIではなくHTMLスクレイピングが必要
  - リアルタイムデータではない
  - ボートレース場と観測地点が一致しない場合がある

#### 2.2 海上保安庁 潮汐表
**URL**: https://www1.kaiho.mlit.go.jp/KANKYO/TIDE/
- **データ**: 潮汐予測データ
- **観測地点**: 全国の港湾
- **問題点**:
  - APIではなくHTMLページ
  - スクレイピングが必要
  - データ形式が複雑

#### 2.3 WorldTides API（有料）
**URL**: https://www.worldtides.info/
- **データ**: 全世界の潮汐予測
- **形式**: JSON API
- **料金**: 有料（月額制）
- **利点**: APIが使いやすい、正確

#### 2.4 オープンデータ
**気象庁オープンデータ**: https://www.data.jma.go.jp/developer/index.html
- 潮位データは限定的

### 3. ボートレース場と潮位の関係

#### 海水場（潮位の影響あり）
1. **大村** (24) - 長崎県大村湾
2. **下関** (20) - 山口県関門海峡
3. **鳴門** (16) - 徳島県鳴門海峡
4. **児島** (15) - 岡山県児島湾
5. **宮島** (18) - 広島県瀬戸内海
6. **丸亀** (17) - 香川県瀬戸内海
7. **福岡** (22) - 福岡県博多湾

#### 淡水場（潮位の影響なし）
- 桐生、戸田、江戸川、平和島、多摩川、浜名湖、蒲郡、常滑、津、びわこ、住之江、尼崎、三国、びわこ、琵琶湖

### 4. 推奨実装方法

#### 方法A: 気象庁データのスクレイピング（無料）
```python
# 気象庁の潮位観測データをスクレイピング
# 各ボートレース場に最も近い観測地点のデータを取得
# 過去データの補完に適している
```

**利点**: 無料、公的機関のデータで信頼性が高い
**欠点**: スクレイピングが必要、観測地点とボートレース場が一致しない

#### 方法B: 簡易計算（天体力学）
```python
# 月の位置から潮汐を計算
# 精度は低いが、傾向は把握可能
```

**利点**: 外部API不要
**欠点**: 精度が低い、実用性に欠ける

#### 方法C: WorldTides API（有料）
```python
# 緯度経度を指定して潮位データを取得
# 正確で使いやすい
```

**利点**: 正確、APIが使いやすい
**欠点**: 有料

### 5. 実装の優先度

#### 現状の判断
1. **ボートレース公式サイトに潮位データなし**
2. **潮位データの重要度**: 予測精度への影響は限定的（風速・気温の方が重要）
3. **コスト**: 無料の気象庁データでもスクレイピング実装コストが高い

#### 推奨アプローチ
**段階的実装**:
1. **Phase 1（現在）**: 潮位データなしで運用（他のデータを優先）
2. **Phase 2（将来）**: 需要があれば気象庁データのスクレイピングを実装
3. **Phase 3（オプション）**: 予測精度向上のためにWorldTides API導入を検討

### 6. データベース設計

現在の `tide` テーブル構造は維持:
```sql
CREATE TABLE tide (
    id INTEGER PRIMARY KEY,
    venue_code TEXT,
    tide_date DATE,
    tide_time TEXT,      -- '09:00', '15:30' など
    tide_type TEXT,      -- '満潮', '干潮'
    tide_level REAL,     -- 潮位（cm）
    created_at TIMESTAMP
)
```

### 7. 結論

**現時点での対応**:
- ボートレース公式サイトに潮位データが存在しないため、**外部APIの実装が必要**
- 潮位データの予測への影響は限定的なため、**優先度は低い**
- `data_coverage_checker.py` には「**潮汐APIの実装が必要**」とステータスを記載

**将来の実装案**:
1. 気象庁潮位観測データのスクレイピング実装
2. ボートレース場ごとに最寄りの観測地点をマッピング
3. 過去データの補完と新規データの自動取得

**当面の対応**:
- データ充足状況レポートに「外部API実装待ち」と明記
- 予測モデルは潮位データなしで構築
- 必要性が確認されてから実装を検討
