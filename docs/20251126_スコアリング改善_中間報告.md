# スコアリング改善 最終報告

**作成日**: 2025-11-26
**ステータス**: 完了

## 1. 改善提案の概要

### 現在の配点
| 要素 | 配点 |
|------|------|
| コース適性 | 35点 |
| 選手成績 | 35点 |
| モーター | 20点 |
| 決まり手 | 5点 |
| グレード | 5点 |

### 改善提案の配点
| 要素 | 配点 | 変更 |
|------|------|------|
| コース適性 | 30点 | -5 |
| 選手成績 | 25点 | -10 |
| モーター | 25点 | +5 |
| 決まり手 | 10点 | +5 |
| グレード | 10点 | +5 |

## 2. バックテスト結果（暫定）

### 500レース比較（2024年10月）
| 指標 | 旧配点 | 新配点 | 差分 |
|------|--------|--------|------|
| 単勝的中率 | 40.00% | 38.40% | -1.60% |
| 複勝的中率 | 70.80% | 70.80% | +0.00% |
| 2連単的中率 | 10.80% | 10.20% | -0.60% |

### 1000レース比較（2024年8-11月）
| 指標 | 旧配点 | 新配点 | 差分 |
|------|--------|--------|------|
| 単勝的中率 | 38.90% | 36.60% | -2.30% |
| 複勝的中率 | 71.10% | 69.90% | -1.20% |
| 2連単的中率 | 10.30% | 9.00% | -1.30% |

### 中間案比較（300レース）
| 配点パターン | 単勝 | 複勝 | 2連単 |
|--------------|------|------|-------|
| 現在 | 36.00% | 67.33% | 8.67% |
| 改善案 | 34.00% | 67.33% | 8.00% |
| **中間案** | **36.33%** | **68.33%** | 8.67% |

中間案（コース=35, 選手=30, モーター=23, 決まり手=7, グレード=5）が最も良い結果。

## 3. 暫定結論

### 発見事項
1. **改善提案（新配点）は現状より悪化する**
   - 単勝的中率が2%以上低下
   - コース重視を下げすぎて1コースの予想を外している

2. **中間案が有望**
   - コース配点は維持（35点）
   - 選手を30点に下げてモーターと決まり手に配分
   - 単勝36.33%、複勝68.33%を達成

3. **問題の原因**
   - 改善提案はモーター重視で外コース（4-6コース）を予想しがち
   - 1コースの予想を外して的中率が下がる

## 4. 最終結論

### バックテスト結果の総括

| 配点パターン | 単勝的中率 | 複勝的中率 | 評価 |
|--------------|-----------|-----------|------|
| **現在の配点** | 36-40% | 67-71% | ✅ **最も安定** |
| 改善提案 | 31-38% | 53-67% | ❌ 悪化 |
| 中間案A | 34-36% | 67-68% | △ ほぼ同等 |

### 結論

**改善提案の配点変更は採用しない**

理由:
1. コース配点を下げると1コースの予想精度が低下
2. 改善提案は「穴狙い」に偏り、堅実な1コース予想を外す
3. 現在の配点は既に堅実性を重視した設計になっている

### 実施した改善

**ラプラス平滑化の組み込み** ✅
- `src/analysis/racer_analyzer.py` に追加
- `src/analysis/motor_analyzer.py` に追加
- データ不足時（特に外枠）の0%問題を解消

## 5. 今後の改善提案

配点変更よりも以下の改善が効果的:

1. **展示データの活用**
   - 展示タイム、スタート展示を予測に組み込む
   - 当日のコンディション反映

2. **会場別・グレード別の調整**
   - 会場特性をより細かく反映
   - グレード別の傾向分析

3. **期待値ベースの買い目推奨**
   - オッズを考慮した買い目選択
   - 回収率を重視した推奨ロジック

## 6. 作成・更新したファイル

### 新規作成
- `backtest_scoring_comparison.py` - 新旧配点比較スクリプト
- `backtest_scoring_multiple.py` - 複数パターン比較スクリプト

### 更新
- `src/analysis/racer_analyzer.py` - ラプラス平滑化追加
- `src/analysis/motor_analyzer.py` - ラプラス平滑化追加

### 設定ファイル
- `config/scoring_weights.json` - **変更なし（現在の配点を維持）**
