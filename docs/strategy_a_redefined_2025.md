# 戦略A（バランス型）再定義版 2025-12-12

## エグゼクティブサマリー

### 重要な発見事項

本分析により、従来の戦略A実績（ROI 298.9%, +380,070円）と現実の乖離が明らかになりました。

**乖離の原因**:
1. **simulate_2025_corrected.py**は「1着予測が的中した場合、実際の2-3着の組み合わせで払戻金を計算」という方式
2. 実運用では「予測した1-2-3着の組み合わせが完全一致」する必要がある
3. 完全一致の3連単的中率は約3-4%（従来想定の8.2%の半分以下）

### 現実的な目標値

| 項目 | 当初目標 | 現実的目標 | 根拠 |
|------|----------|------------|------|
| 年間ROI | 200%以上 | 150%以上 | バックテスト実績159.9% |
| 年間収支 | +30万円以上 | +5万円以上 | バックテスト実績+53,190円 |
| 月間的中 | 3-5回 | 1-2回 | 実績1.2回/月 |
| 黒字月率 | 70%以上 | 50%以上 | 的中頻度から推定 |

### 新戦略Aの概要

| 項目 | 値 |
|------|-----|
| **年間購入** | 296レース（月29.6レース） |
| **年間的中** | 12回（月1.2回） |
| **年間投資** | 88,800円（月8,880円） |
| **年間払戻** | 141,990円 |
| **年間収支** | **+53,190円** |
| **ROI** | **159.9%** |

---

## 1. 現状分析

### 1.1 予測データの2つのタイプ

| タイプ | 説明 | 精度 | 用途 |
|--------|------|------|------|
| **before（直前情報）** | 展示タイム・ST・進入コース等を加味 | 高精度（1着的中率30-40%） | 最終購入判定 |
| **advance（事前情報）** | 出走表情報のみで生成 | 低精度（1着的中率5-10%） | 候補抽出 |

**2025年データ統計**:
- before予測: 17,264レース, 103,581件
- advance予測: 17,298レース, 103,785件

### 1.2 最新バックテスト結果

#### simulate_2025_corrected.py（参考値）
- **方式**: 1着予測的中時、実際の着順で払戻金計算
- **結果**: ROI 430.2%, +783,520円 (791購入, 303的中)
- **注意**: 実運用とは異なる計算方式

#### 正確なバックテスト（3連単完全一致）
- **方式**: 予測した1-2-3着が実際の結果と完全一致
- **結果**: ROI 159.9%, +53,190円 (296購入, 12的中)
- **的中率**: 4.1%

### 1.3 過去実績との差異要因

| 要因 | 影響度 | 説明 |
|------|--------|------|
| **計算方式の違い** | 高 | 1着的中のみ vs 3連単完全一致 |
| **オッズ範囲の狭さ** | 中 | 従来条件では該当レースが激減 |
| **予測精度の限界** | 中 | 2着・3着予測精度は35-40%程度 |

---

## 2. 新戦略A定義

### 2.1 全体構成（Tier1/2/3）

新戦略Aは、バックテストで**プラス収支が確認できた4条件**で構成されます。

| Tier | 目的 | 条件数 | 購入/年 | 的中/年 | ROI | 収支/年 |
|------|------|--------|---------|---------|-----|---------|
| **Tier1** | 高配当主力 | 1条件 | 133件 | 5件 | 192.8% | +37,020円 |
| **Tier2** | 中配当補助 | 2条件 | 123件 | 4件 | 138.6% | +14,220円 |
| **Tier3** | 穴条件 | 1条件 | 40件 | 3件 | 116.3% | +1,950円 |
| **合計** | - | 4条件 | 296件 | 12件 | 159.9% | +53,190円 |

### 2.2 購入条件詳細

#### Tier1: 高配当主力

| 条件 | 信頼度 | 1C級別 | オッズ範囲 | 購入/年 | 的中 | 的中率 | ROI | 収支 | 賭け金 |
|------|--------|--------|------------|---------|------|--------|-----|------|--------|
| **D x B1 x 60-100倍** | D | B1 | 60-100倍 | 133件 | 5件 | 3.8% | 192.8% | +37,020円 | 300円 |

**特徴**:
- 最も収益貢献が大きい条件
- 信頼度D（データ充実度が低い）が逆にチャンス
- B1級1コースの中穴レースを狙う

#### Tier2: 中配当補助

| 条件 | 信頼度 | 1C級別 | オッズ範囲 | 購入/年 | 的中 | 的中率 | ROI | 収支 | 賭け金 |
|------|--------|--------|------------|---------|------|--------|-----|------|--------|
| **C x B1 x 40-60倍** | C | B1 | 40-60倍 | 30件 | 1件 | 3.3% | 188.3% | +7,950円 | 300円 |
| **C x B1 x 80-120倍** | C | B1 | 80-120倍 | 93件 | 3件 | 3.2% | 122.5% | +6,270円 | 300円 |

**特徴**:
- 信頼度Cはデータ充実度が中程度
- B1級の中穴〜高配当帯を幅広くカバー
- Tier1の補助として安定性に寄与

#### Tier3: 穴条件

| 条件 | 信頼度 | 1C級別 | オッズ範囲 | 購入/年 | 的中 | 的中率 | ROI | 収支 | 賭け金 |
|------|--------|--------|------------|---------|------|--------|-----|------|--------|
| **D x A2 x 30-100倍** | D | A2 | 30-100倍 | 40件 | 3件 | 7.5% | 116.3% | +1,950円 | 300円 |

**特徴**:
- A2級の穴レースを狙う
- 的中率が最も高い（7.5%）
- 収支貢献は小さいが、的中頻度向上に寄与

### 2.3 除外条件

以下の条件は、バックテストでマイナス収支となったため除外します。

| 条件 | ROI | 収支 | 除外理由 |
|------|-----|------|----------|
| D x B1 x 200-300倍 | 15.2% | -15,780円 | オッズ範囲が狭すぎ、サンプル不足 |
| D x A1 x 100-150倍 | 0% | -900円 | 該当レースが極めて少ない |
| D x A1 x 200-300倍 | 0% | -300円 | 該当レースが極めて少ない |
| C x B1 x 150-200倍 | 76% | -4,680円 | ROI 100%未満 |
| 信頼度A, B | - | - | サンプル不足、精度不安定 |

### 2.4 想定実績（2025年データ）

#### 月別シミュレーション

| 月 | 購入 | 投資 | 的中 | 払戻 | 収支 | ROI |
|----|------|------|------|------|------|-----|
| 平均 | 29.6件 | 8,880円 | 1.2件 | 14,199円 | +5,319円 | 159.9% |

**注意**: 的中がない月（0的中）が年間4-5ヶ月発生する可能性があります。

#### リスク評価

| 指標 | 値 | 評価 |
|------|-----|------|
| 最大連敗数 | 約50レース | 許容範囲 |
| 最大ドローダウン | 約15,000円 | 許容範囲 |
| 0的中月の確率 | 約30-40% | やや高リスク |
| 黒字月率 | 約50-60% | 許容範囲 |

---

## 3. 実装方針

### 3.1 bet_target_evaluator.py修正

現在の`BET_CONDITIONS`を以下に置き換えます。

```python
BET_CONDITIONS = {
    # 信頼度C: 中配当補助（Tier2）
    'C': [
        # C x B1 x 40-60倍
        {
            'method': '両方式',
            'odds_min': 40, 'odds_max': 60,
            'c1_rank': ['B1'],
            'expected_roi': 188.3,
            'bet_amount': 300,
            'priority': 1,
            'description': 'Tier2: C×B1級中配当A',
        },
        # C x B1 x 80-120倍
        {
            'method': '両方式',
            'odds_min': 80, 'odds_max': 120,
            'c1_rank': ['B1'],
            'expected_roi': 122.5,
            'bet_amount': 300,
            'priority': 2,
            'description': 'Tier2: C×B1級中配当B',
        },
    ],
    # 信頼度D: 高配当主力（Tier1）+ 穴条件（Tier3）
    'D': [
        # D x B1 x 60-100倍（主力）
        {
            'method': '両方式',
            'odds_min': 60, 'odds_max': 100,
            'c1_rank': ['B1'],
            'expected_roi': 192.8,
            'bet_amount': 300,
            'priority': 1,
            'description': 'Tier1: D×B1級高配当主力',
        },
        # D x A2 x 30-100倍（穴条件）
        {
            'method': '両方式',
            'odds_min': 30, 'odds_max': 100,
            'c1_rank': ['A2'],
            'expected_roi': 116.3,
            'bet_amount': 300,
            'priority': 2,
            'description': 'Tier3: D×A2級穴条件',
        },
    ],
}
```

### 3.2 運用フロー

#### 事前情報（advance）での候補抽出

1. **レース一覧取得**: 当日の全レースを取得
2. **予測生成**: advance予測を生成
3. **候補抽出**: 信頼度C, Dかつ1コースB1/A2級のレースをリストアップ
4. **優先度付け**: オッズ範囲条件に合致するレースをマーキング

#### 直前情報（before）での最終判定

1. **直前情報取得**: レース30分前に直前情報をスクレイピング
2. **予測更新**: before予測を生成
3. **最終判定**:
   - 信頼度がC or Dを維持しているか
   - オッズが条件範囲内か（60-100倍、40-60倍、80-120倍、30-100倍）
   - 1コース級別がB1 or A2か
4. **購入決定**: 条件を満たす場合、300円で購入

#### 実運用での具体的手順

```
09:00 当日レース一覧取得
      ↓
09:30 advance予測生成、候補レース抽出
      ↓
レース30分前 直前情報取得
      ↓
レース25分前 before予測生成
      ↓
レース20分前 最終購入判定
      ↓
レース15分前 舟券購入（締切10分前）
```

### 3.3 バックテスト標準化

今後のバックテストは以下の方式で統一します。

**標準バックテスト仕様**:
- 的中判定: **3連単完全一致**（予測1-2-3着 = 実際1-2-3着）
- オッズ: **1コース頭の平均オッズ**（trifecta_oddsテーブル、combination LIKE '1-%'）
- 払戻金: **payoutsテーブルのamount**（100円あたり）× 賭け金/100
- 予測タイプ: **before**（直前情報あり）

---

## 4. 移行計画

### 4.1 即時実施項目（Day 1）

1. **bet_target_evaluator.py の更新**
   - 新しいBET_CONDITIONS定義に置き換え
   - 除外条件の明確化

2. **バックテストスクリプトの修正**
   - 3連単完全一致方式への統一
   - 標準バックテスト仕様の適用

### 4.2 1週間以内

1. **UIへの反映**
   - 「総合」タブの購入判定ロジック更新
   - 新条件に基づくレース候補表示

2. **モニタリング体制の構築**
   - 日次収支ログの自動記録
   - 条件別的中率の追跡

### 4.3 1ヶ月以内

1. **実運用テスト**
   - 1ヶ月間の並行運用（実際の購入は任意）
   - 予測精度と実績の比較分析

2. **戦略の微調整**
   - オッズ範囲の微調整（±10倍程度）
   - 新規条件の探索（ROI 150%以上、30件以上）

---

## 5. リスク管理

### 5.1 ロールバック条件

以下のいずれかに該当した場合、旧戦略に戻す判断を行います。

| 条件 | 閾値 | 判定期間 |
|------|------|----------|
| ROI | 80%未満 | 3ヶ月 |
| 的中率 | 1%未満 | 3ヶ月 |
| 累計収支 | -30,000円以下 | 3ヶ月 |

### 5.2 モニタリング指標

| 指標 | 頻度 | 閾値（警告） | 閾値（停止） |
|------|------|--------------|--------------|
| 月間ROI | 月次 | 80%未満 | 50%未満 |
| 月間的中数 | 月次 | 0回 | 連続2ヶ月0回 |
| 条件別ROI | 週次 | 個別100%未満 | 個別50%未満 |

---

## 6. 付録

### 6.1 詳細バックテスト結果

#### 条件別実績（2025年全期間）

| 条件 | 購入 | 的中 | 的中率 | 投資 | 払戻 | 収支 | ROI |
|------|------|------|--------|------|------|------|-----|
| D x B1 x 60-100倍 | 133 | 5 | 3.8% | 39,900 | 76,920 | +37,020 | 192.8% |
| C x B1 x 40-60倍 | 30 | 1 | 3.3% | 9,000 | 16,950 | +7,950 | 188.3% |
| C x B1 x 80-120倍 | 93 | 3 | 3.2% | 27,900 | 34,170 | +6,270 | 122.5% |
| D x A2 x 30-100倍 | 40 | 3 | 7.5% | 12,000 | 13,950 | +1,950 | 116.3% |
| **合計** | **296** | **12** | **4.1%** | **88,800** | **141,990** | **+53,190** | **159.9%** |

### 6.2 除外条件の検証結果

#### 従来戦略A条件の実績（3連単完全一致）

| 条件 | 購入 | 的中 | ROI | 収支 | 判定 |
|------|------|------|-----|------|------|
| D x B1 x 200-300倍 | 62 | 1 | 15.2% | -15,780 | 除外 |
| D x A1 x 100-150倍 | 3 | 0 | 0% | -900 | 除外 |
| D x A1 x 200-300倍 | 1 | 0 | 0% | -300 | 除外 |
| C x B1 x 150-200倍 | 65 | 3 | 76.0% | -4,680 | 除外 |
| D x A2 x 30-40倍 | 5 | 0 | 0% | -1,500 | 除外 |
| D x A1 x 40-50倍 | 10 | 1 | 65.0% | -1,050 | 除外 |
| D x A1 x 20-25倍 | 0 | 0 | - | 0 | 該当なし |
| D x B1 x 5-10倍 | 0 | 0 | - | 0 | 該当なし |

**結論**: 従来の戦略A条件は、オッズ範囲が狭すぎて該当レースが少なく、3連単完全一致ではマイナス収支となります。

---

## 変更履歴

| 日付 | 変更内容 | 担当 |
|------|----------|------|
| 2025-12-12 | 初版作成 | Claude Code (Opus 4.5) |

---

**作成者**: Claude Code (Opus 4.5)
**最終更新**: 2025-12-12
