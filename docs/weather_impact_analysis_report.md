# 気象情報活用の効果検証レポート

**分析日**: 2025-12-12
**対象期間**: 2025-11-28 ~ 2025-12-10（天候データが完全に揃っている期間）
**分析対象**: 607レース（3,642艇）

---

## 1. エグゼクティブサマリー

Phase 1-3で実装した気象情報活用機能の効果を検証しました。

### 主な発見事項

1. **気象スコアの分布**
   - 62.3%の艇で気象スコア = 0点（通常条件）
   - 24.7%の艇でプラス補正（+2点台が中心）
   - 12.9%の艇でマイナス補正（-2点台が中心）

2. **予測精度への影響**
   - **3連対的中率**: 58.8% → 58.5% (**-0.3pt**)
   - **1着的中率**: 30.3% → 28.8% (**-1.4pt**)
   - **現時点では精度向上に貢献していない**

3. **天候別の影響**
   - 曇天で若干の改善（+0.0pt）
   - 晴天・雨天・霧では精度低下
   - 特に曇天・霧で1着的中率が低下（-3.6pt, -3.7pt）

---

## 2. 詳細分析結果

### 2.1 気象スコア分布

| スコア範囲 | 艇数 | 割合 |
|-----------|-----|------|
| -2点台 | 470艇 | 12.9% |
| 0点台 | 2,269艇 | 62.3% |
| +2点台 | 901艇 | 24.7% |
| +4点台 | 2艇 | 0.1% |

**考察**:
- 大部分のレースで気象条件が通常範囲内（スコア=0）
- 極端な気象条件（|スコア| ≥ 5.0点）は2件のみ（0.05%）

### 2.2 展示コース別の平均気象スコア

| 展示コース | 平均スコア | サンプル数 |
|-----------|----------|-----------|
| 1コース | -0.65点 | 607 |
| 2コース | -0.67点 | 607 |
| 3コース | -0.24点 | 607 |
| 4コース | +0.70点 | 607 |
| 5コース | +0.69点 | 607 |
| 6コース | +0.71点 | 607 |

**考察**:
- インコース（1-3コース）で平均マイナススコア
- 外コース（4-6コース）で平均プラススコア
- 実装したロジック（気温・水温差、低水温）が外コース有利に働く傾向

### 2.3 天候別の平均気象スコア

| 天候 | 平均スコア | サンプル数 |
|------|----------|-----------|
| 晴 | +0.08点 | 2,910 |
| 曇 | +0.11点 | 672 |
| 霧 | +0.04点 | 54 |
| 雨 | +0.33点 | 6 |

**考察**:
- 雨天で最もプラススコアが高い（+0.33点）
- ただし雨天のサンプル数が極めて少ない（6艇のみ）

### 2.4 極端な気象条件のケース

| レース | 艇番 | 気象スコア | 総合スコア | 条件 |
|--------|------|-----------|-----------|------|
| 2025-12-05 14R02 | 1号艇 | +5.00点 | -18.00点 | 気温9.0℃, 水温16.0℃, 霧 |
| 2025-12-05 14R02 | 2号艇 | +5.00点 | 10.00点 | 気温9.0℃, 水温16.0℃, 霧 |

**考察**:
- 気温・水温差7℃、低気温（9℃）、霧の組み合わせ
- 気象スコアのみで+5.00点の補正
- ただし、このような極端なケースは全体の0.05%のみ

---

## 3. 予測精度への影響（ベースライン vs 拡張版）

### 3.1 全体統計

#### 3連対的中数
- **ベースライン**: 973 / 1,656 (58.8%)
- **拡張版**: 968 / 1,656 (58.5%)
- **改善**: **-0.3ポイント**

#### 1着的中数
- **ベースライン**: 167 / 552 (30.3%)
- **拡張版**: 159 / 552 (28.8%)
- **改善**: **-1.4ポイント**

### 3.2 天候条件別統計

| 天候 | サンプル数 | 3連対的中率の変化 | 1着的中率の変化 |
|------|-----------|-----------------|----------------|
| 曇天 | 45レース | +0.0pt | +0.0pt |
| 晴天 | 385レース | -0.2pt | -1.0pt |
| 雨天 | 112レース | -0.6pt | -3.6pt |
| 霧 | 9レース | -3.7pt | +0.0pt |
| 雪 | 1レース | +0.0pt | +0.0pt |

**考察**:
- 曇天・雪天ではニュートラル
- 晴天・雨天・霧では精度が低下
- 特に雨天・霧での1着的中率低下が顕著

---

## 4. ピット番号別の気象スコア影響

### 4.1 晴天時（n=485レース）

| ピット | 平均気象スコア |
|--------|--------------|
| 1号艇 | -0.69点 |
| 2号艇 | -0.71点 |
| 3号艇 | -0.23点 |
| 4号艇 | +0.71点 |
| 5号艇 | +0.71点 |
| 6号艇 | +0.72点 |

### 4.2 曇天時（n=112レース）

| ピット | 平均気象スコア |
|--------|--------------|
| 1号艇 | -0.54点 |
| 2号艇 | -0.52点 |
| 3号艇 | -0.24点 |
| 4号艇 | +0.67点 |
| 5号艇 | +0.58点 |
| 6号艇 | +0.71点 |

**考察**:
- 晴天・曇天ともに同様のパターン
- インコース（1-3号艇）がマイナス補正
- 外コース（4-6号艇）がプラス補正
- この傾向が実際のレース結果と逆相関している可能性

---

## 5. 問題点の分析

### 5.1 なぜ精度が低下したのか？

#### ① 気象スコアのロジックが不適切

現在の実装:
```python
# 気温・水温差が大きい（5℃以上）→ インコース有利
if temp_diff >= 5.0:
    if course <= 2:
        score += 3.0  # インコース有利
    else:
        score -= 1.0  # 外コース不利

# 水温が低い（15℃未満）→ インコース不利
if water_temp < 15.0:
    if course <= 2:
        score -= 3.0  # インコース不利
    elif course >= 4:
        score += 2.0  # 外コース有利
```

**問題**:
- 実際のデータでは、水温15℃未満のケースが多い（冬季データ）
- このロジックが常にインコース不利・外コース有利に働く
- しかし実際のレース結果ではインコースが依然として有利

#### ② サンプル期間が冬季に偏っている

- 分析期間: 2025-11-28 ~ 2025-12-10（冬季）
- 気温9-15℃のケースが多数
- 夏季・春季のデータがないため、ロジックの汎用性を検証できていない

#### ③ 気象条件の影響度が小さい

- 平均気象スコア: -0.7 ~ +0.7点（110点満点中）
- 影響度が0.6-0.9%と非常に小さい
- 他の要素（展示タイム、STなど）に埋もれている可能性

---

## 6. 推奨事項

### 6.1 短期的な対応（優先度: 高）

#### ① 気象スコアロジックの見直し

**現状の問題**:
- 水温15℃未満でインコース-3点は過剰
- 気温・水温差5℃以上の判定基準が不適切

**推奨修正**:
```python
# より緩やかな調整
if water_temp < 12.0:  # 12℃未満に変更
    if course <= 2:
        score -= 1.5  # -3.0 → -1.5に減少
    elif course >= 4:
        score += 1.0  # +2.0 → +1.0に減少

# 気温・水温差の判定を厳格化
if temp_diff >= 8.0:  # 5℃ → 8℃に変更
    if course <= 2:
        score += 2.0  # +3.0 → +2.0に減少
    else:
        score -= 0.5  # -1.0 → -0.5に減少
```

#### ② 暫定的に気象スコアの重みを減少

```python
# 現在: 10点満点
self.WEATHER_SCORE_WEIGHT = 5.0  # 10.0 → 5.0に半減

# 総合スコア: 110点満点 → 105点満点
```

### 6.2 中期的な対応（優先度: 中）

#### ① より多くのデータでの検証

- 春季・夏季データでの検証（2025年4-8月）
- 年間を通した気象パターンの分析
- 会場別の気象特性の分析

#### ② 統計的アプローチの導入

- 過去データから気象条件と成績の相関を分析
- 機械学習モデルによる最適な気象スコア算出
- ベイズ最適化による重みパラメータの調整

#### ③ 気象条件の詳細化

- 風向・風速の影響をより詳細に評価
- 波高の影響を定量化
- 気圧・湿度などの追加要素の検討

### 6.3 長期的な対応（優先度: 低）

#### ① 会場別の気象モデル

- 各会場の特性（海水/淡水、屋外/屋内など）を考慮
- 会場別の気象影響係数の導入

#### ② リアルタイム気象データの活用

- レース直前の気象変化を反映
- 時間帯別の気象影響の分析

---

## 7. 結論

### 7.1 現状評価

気象情報活用機能（Phase 1-3）を実装しましたが、**現時点では予測精度の向上には貢献していません**。

- 3連対的中率: -0.3ポイント
- 1着的中率: -1.4ポイント

### 7.2 主な原因

1. **気象スコアロジックが実際のレース結果と逆相関**
   - 低水温時にインコース不利と判定 → 実際はインコース依然有利

2. **サンプル期間が冬季に偏っている**
   - 通年データでの検証が必要

3. **気象影響度が小さい**
   - 平均±0.7点では他の要素に埋もれる

### 7.3 次のアクション

1. **即座に実施**: 気象スコアの重みを10点→5点に半減（影響を抑制）
2. **1週間以内**: 気象スコアロジックの修正（閾値・重みの調整）
3. **1ヶ月以内**: 通年データでの再検証、統計的アプローチの検討

### 7.4 学んだこと

- データ駆動型の開発の重要性
- 仮説ベースのロジックは必ず検証が必要
- 小さな変更でも必ずバックテストで効果測定

---

## 付録

### A. 分析スクリプト

- [scripts/analyze_weather_impact.py](../scripts/analyze_weather_impact.py)
- [scripts/test_weather_integration.py](../scripts/test_weather_integration.py)

### B. 実装ファイル

- Phase 1: [src/analysis/beforeinfo_scorer.py](../src/analysis/beforeinfo_scorer.py#L520-557)
- Phase 2: [src/analysis/beforeinfo_scorer.py](../src/analysis/beforeinfo_scorer.py#L580-630)
- Phase 3: [src/analysis/weather_adjuster.py](../src/analysis/weather_adjuster.py#L229-275)

### C. データベーススキーマ

- [docs/DATABASE_SCHEMA.md](DATABASE_SCHEMA.md)
