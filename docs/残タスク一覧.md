# 残タスク一覧

更新日: 2025-11-30

## 1. 女子選手の性別判定改善

### 現状の問題
- 現在は名前の末尾（「子」「美」「香」「奈」「恵」「代」）で性別を推定している
- この方法は確実ではない（例：男性で「〇〇美」という名前もありうる）

### 改善案
- 公式サイトの選手データを解析し、女子選手フラグを事前にDBに保存する
- `racers`テーブルに`gender`カラムを追加し、選手マスタとして管理
- 予測時はDBから性別を参照する方式に変更

### 対象ファイル
- `src/database/models.py`（`racers`テーブルに`gender`カラム追加）
- 選手データ解析スクリプト（新規作成）
- `src/analysis/race_predictor.py`（性別取得ロジックをDB参照に変更）

---

## 2. レースタイプ別モデル分割の調整

### 内容
- レースタイプ（一般戦、G3、G2、G1、SG等）に応じたモデルの分割・調整
- 各グレードで異なる特徴量の重み付けや予測ロジックの最適化

### 検討事項
- グレードごとの選手層の違い（SGはA1級が中心）
- 賞金額による選手のモチベーション差
- 節間の疲労度や調整の違い

---

## 3. その他の潜在的な改善点（優先度低）

| 項目 | 現状 | 備考 |
|------|------|------|
| 進入予想 | 未実装 | `config/prediction_improvements.json`で`enabled: false` |
| 潮位補正 | 未実装 | 同上 |
| モーターEWMA | 未実装 | 同上 |
| 確率較正 | 未実装 | 同上 |

---

## 完了済みタスク（2025-11-30）

- ✅ 直前情報取得ボタンのサイドバーフィルター対応
- ✅ 予測エラーメッセージの改善（展示データ未取得時）
- ✅ 1着固定ルールの閾値調整（データ充実度 60→40）
- ✅ 推定勝率計算の修正（相対スコア方式に変更）
- ✅ 法則エンジンの設計修正
  - 選手ランク法則のフィルタリング（A1/A2/B1/B2）
  - 風向法則のフィルタリング
  - 女子法則のフィルタリング
- ✅ StreamlitDuplicateElementKeyエラーの修正
