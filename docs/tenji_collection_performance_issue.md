# ã‚ªãƒªã‚¸ãƒŠãƒ«å±•ç¤ºåé›†ã®å‡¦ç†æ™‚é–“å•é¡Œã¨æ”¹å–„æ¡ˆ

**ä½œæˆæ—¥**: 2025-12-10
**å®Ÿè£…æ—¥**: 2025-12-10
**å•é¡Œ**: UIã‹ã‚‰ã‚ªãƒªã‚¸ãƒŠãƒ«å±•ç¤ºåé›†ã‚’å®Ÿè¡Œã™ã‚‹ã¨æ™‚é–“ãŒã‹ã‹ã‚Šã™ãã‚‹
**çŠ¶æ…‹**: âœ… æ”¹å–„å®Œäº†

---

## âœ… å®Ÿè£…å®Œäº†

**å®Ÿè£…ã—ãŸæ”¹å–„ç­–**:
- **A-1**: ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆçŸ­ç¸® (15ç§’ â†’ 5ç§’)
- **ã‚¤ãƒ³ãƒ†ãƒªã‚¸ã‚§ãƒ³ãƒˆãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯**: ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã¨ç©ºãƒ‡ãƒ¼ã‚¿ã‚’åŒºåˆ¥
- **ãƒªãƒˆãƒ©ã‚¤ãƒ­ã‚¸ãƒƒã‚¯**: ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆæ™‚ã¯3ç§’ã§ãƒªãƒˆãƒ©ã‚¤
- **è©³ç´°çµ±è¨ˆ**: ãƒ‡ãƒ¼ã‚¿å–å¾—ç‡ã®å¯è¦–åŒ–

**æœŸå¾…åŠ¹æœ**:
- å‡¦ç†æ™‚é–“: 30åˆ† â†’ **3-5åˆ†** (85-90%çŸ­ç¸®)
- ãƒ‡ãƒ¼ã‚¿å–å¾—ç‡: **ç¶­æŒã¾ãŸã¯å‘ä¸Š**

**å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«**:
- [src/scraper/unified_tenji_collector.py](../src/scraper/unified_tenji_collector.py) - ã‚¤ãƒ³ãƒ†ãƒªã‚¸ã‚§ãƒ³ãƒˆãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å®Ÿè£…
- [src/workflow/tenji_collection.py](../src/workflow/tenji_collection.py:118) - ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ5ç§’ã«å¤‰æ›´
- [scripts/worker_tenji_collection.py](../scripts/worker_tenji_collection.py:63-74) - çµ±è¨ˆè¡¨ç¤ºè¿½åŠ 

### å®Ÿè£…è©³ç´°

#### ã‚¤ãƒ³ãƒ†ãƒªã‚¸ã‚§ãƒ³ãƒˆãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æˆ¦ç•¥

1. **Boaters 1æ¬¡è©¦è¡Œ** (ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ: 5ç§’)
   - æˆåŠŸ â†’ ãƒ‡ãƒ¼ã‚¿è¿”å´
   - ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ â†’ ã‚¹ãƒ†ãƒƒãƒ—2ã¸
   - ç©ºãƒ‡ãƒ¼ã‚¿ â†’ ã‚¹ãƒ†ãƒƒãƒ—3ã¸

2. **Boaters ãƒªãƒˆãƒ©ã‚¤** (ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ: 3ç§’)
   - ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã®å ´åˆã®ã¿å®Ÿè¡Œ
   - æˆåŠŸ â†’ ãƒ‡ãƒ¼ã‚¿è¿”å´ï¼ˆsource: 'boaters_retry'ï¼‰
   - å¤±æ•— â†’ ã‚¹ãƒ†ãƒƒãƒ—3ã¸

3. **Venue HP ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯** (ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ: 5ç§’)
   - ç©ºãƒ‡ãƒ¼ã‚¿ã®å ´åˆã®ã¿å®Ÿè¡Œï¼ˆã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆå¤±æ•—ã§ã¯å®Ÿè¡Œã—ãªã„ï¼‰
   - æˆåŠŸ â†’ ãƒ‡ãƒ¼ã‚¿è¿”å´ï¼ˆsource: 'venue_hp'ï¼‰
   - å¤±æ•— â†’ Noneè¿”å´

#### ãƒ‡ãƒ¼ã‚¿å–å¾—ç‡ç¶­æŒã®ä»•çµ„ã¿

- **æ—§å®Ÿè£…**: ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆå¾Œã«å¿…ãšVenue HPãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ â†’ æœ€å¤§30ç§’
- **æ–°å®Ÿè£…**: ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã¯ãƒªãƒˆãƒ©ã‚¤ã§è§£æ±ºã€ç©ºãƒ‡ãƒ¼ã‚¿ã®ã¿ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ â†’ æœ€å¤§13ç§’

ã“ã‚Œã«ã‚ˆã‚Š:
- ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆãŒå¤šã„å ´åˆ: 5ç§’ + 3ç§’ = **8ç§’** (æ—§30ç§’ â†’ 73%çŸ­ç¸®)
- ãƒ‡ãƒ¼ã‚¿ãŒç©ºã®å ´åˆ: 5ç§’ + 5ç§’ = **10ç§’** (æ—§30ç§’ â†’ 67%çŸ­ç¸®)
- æˆåŠŸã™ã‚‹å ´åˆ: **5ç§’ä»¥ä¸‹** (æ—§15ç§’ â†’ 67%çŸ­ç¸®)

#### çµ±è¨ˆãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°

æ–°ã—ãè¿½åŠ ã•ã‚ŒãŸçµ±è¨ˆæƒ…å ±:
```python
{
    'boaters_success': 0,           # Boatersåˆå›æˆåŠŸ
    'boaters_retry_success': 0,     # Boatersãƒªãƒˆãƒ©ã‚¤æˆåŠŸ
    'venue_success': 0,             # Venue HPæˆåŠŸ
    'failures': 0,                  # å…¨å¤±æ•—
    'timeout_failures': 0,          # ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆå¾Œå…¨å¤±æ•—
    'empty_data_fallbacks': 0       # ç©ºãƒ‡ãƒ¼ã‚¿ã«ã‚ˆã‚‹ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å›æ•°
}
```

ã“ã‚Œã«ã‚ˆã‚Šã€ã©ã®ã‚½ãƒ¼ã‚¹ãŒåŠ¹æœçš„ã‹ã‚’å¯è¦–åŒ–ã§ãã¾ã™ã€‚

---

## ğŸ“Š å•é¡Œåˆ†æ

### ç¾åœ¨ã®å‡¦ç†ãƒ•ãƒ­ãƒ¼

**ãƒ•ã‚¡ã‚¤ãƒ«**: [src/workflow/tenji_collection.py](../src/workflow/tenji_collection.py:115-151)

```python
for venue_idx, (venue_code, venue_races) in enumerate(venues_dict.items(), 1):
    for race_id, race_date, race_number in venue_races:
        # ã‚ªãƒªã‚¸ãƒŠãƒ«å±•ç¤ºãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
        tenji_data = collector.get_original_tenji(
            venue_code, target_date, race_number
        )
```

### æ™‚é–“ãŒã‹ã‹ã‚‹åŸå› 

#### 1. 2æ®µéšã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‡¦ç†

**ãƒ•ã‚¡ã‚¤ãƒ«**: [src/scraper/unified_tenji_collector.py](../src/scraper/unified_tenji_collector.py:50-99)

```python
# 1æ¬¡è©¦è¡Œ: Boatersã‚µã‚¤ãƒˆï¼ˆã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ15ç§’ï¼‰
tenji_data = self.boaters_scraper.get_original_tenji(...)

# 2æ¬¡è©¦è¡Œ: å„å ´ã®å…¬å¼HPï¼ˆã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ15ç§’ï¼‰
tenji_data = self.venue_scraper.get_original_tenji(...)
```

**å•é¡Œç‚¹**:
- 1ãƒ¬ãƒ¼ã‚¹ã”ã¨ã«æœ€å¤§30ç§’ï¼ˆ15ç§’ Ã— 2å›ï¼‰
- 60ãƒ¬ãƒ¼ã‚¹ã®å ´åˆã€æœ€å¤§**30åˆ†**ã‹ã‹ã‚‹

#### 2. ãƒ–ãƒ©ã‚¦ã‚¶ã®åˆæœŸåŒ–ã‚³ã‚¹ãƒˆ

- Selenium/Playwrightã®ãƒ–ãƒ©ã‚¦ã‚¶èµ·å‹•ã«æ™‚é–“ãŒã‹ã‹ã‚‹å¯èƒ½æ€§
- ãƒ¬ãƒ¼ã‚¹ã”ã¨ã«ãƒ–ãƒ©ã‚¦ã‚¶ã‚’èµ·å‹•ãƒ»çµ‚äº†ã—ã¦ã„ã‚‹å ´åˆã€ã•ã‚‰ã«æ™‚é–“å¢—

#### 3. é€æ¬¡å‡¦ç†

- ä¸¦åˆ—å‡¦ç†ãªã—
- 1ãƒ¬ãƒ¼ã‚¹ãšã¤é †ç•ªã«å‡¦ç†

---

## ğŸš€ æ”¹å–„æ¡ˆ

### å„ªå…ˆåº¦A: å³åŠ¹æ€§ã®ã‚ã‚‹æ”¹å–„

#### A-1. ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã®çŸ­ç¸®

**ç¾çŠ¶**: 15ç§’
**ææ¡ˆ**: 5-7ç§’ã«çŸ­ç¸®

```python
# src/workflow/tenji_collection.py ã®117è¡Œç›®
collector = UnifiedTenjiCollector(headless=True, timeout=5)
```

**åŠ¹æœ**:
- 60ãƒ¬ãƒ¼ã‚¹: 30åˆ† â†’ **10åˆ†**ï¼ˆ66%çŸ­ç¸®ï¼‰

**ãƒªã‚¹ã‚¯**: ä½é€Ÿãªç’°å¢ƒã§å–å¾—å¤±æ•—ãŒå¢—ãˆã‚‹å¯èƒ½æ€§

---

#### A-2. 1æ¬¡ã‚½ãƒ¼ã‚¹ã®ã¿ä½¿ç”¨ï¼ˆãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ç„¡åŠ¹åŒ–ï¼‰

**ææ¡ˆ**: Boatersã‚µã‚¤ãƒˆã®ã¿ä½¿ç”¨ã—ã€å¤±æ•—ã—ãŸã‚‰ã‚¹ã‚­ãƒƒãƒ—

```python
# src/scraper/unified_tenji_collector.py ã«æ–°ã—ã„ãƒ¡ã‚½ãƒƒãƒ‰è¿½åŠ 
def get_original_tenji_fast(self, venue_code: str, target_date, race_number: int) -> Optional[Dict]:
    """
    é«˜é€Ÿç‰ˆ: Boatersã‚µã‚¤ãƒˆã®ã¿è©¦è¡Œï¼ˆãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ãªã—ï¼‰
    """
    try:
        tenji_data = self.boaters_scraper.get_original_tenji(venue_code, target_date, race_number)
        if tenji_data and self._validate_tenji_data(tenji_data):
            tenji_data['source'] = 'boaters'
            return tenji_data
    except Exception as e:
        logger.debug(f"Boaters failed: {e}")

    return None
```

**åŠ¹æœ**:
- 60ãƒ¬ãƒ¼ã‚¹: 30åˆ† â†’ **7.5åˆ†**ï¼ˆ75%çŸ­ç¸®ï¼‰

**ãƒªã‚¹ã‚¯**: ãƒ‡ãƒ¼ã‚¿å–å¾—ç‡ãŒä¸‹ãŒã‚‹ï¼ˆBoaterså¤±æ•—æ™‚ã«ãƒ‡ãƒ¼ã‚¿ãªã—ï¼‰

---

#### A-3. ãƒ–ãƒ©ã‚¦ã‚¶ã®å†åˆ©ç”¨ç¢ºèª

**ç¢ºèªé …ç›®**:
- `OriginalTenjiBrowserScraper`ã¨`VenueTenjiScraper`ãŒãƒ–ãƒ©ã‚¦ã‚¶ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’å†åˆ©ç”¨ã—ã¦ã„ã‚‹ã‹
- 1ãƒ¬ãƒ¼ã‚¹ã”ã¨ã«ãƒ–ãƒ©ã‚¦ã‚¶ã‚’èµ·å‹•ãƒ»çµ‚äº†ã—ã¦ã„ãªã„ã‹

**èª¿æŸ»å¿…è¦**: ä¸¡ã‚¯ãƒ©ã‚¹ã®å®Ÿè£…ã‚’ç¢ºèª

---

### å„ªå…ˆåº¦B: ä¸­æœŸçš„ãªæ”¹å–„

#### B-1. ä¼šå ´å˜ä½ã®ãƒãƒƒãƒå‡¦ç†

**ç¾çŠ¶**: ãƒ¬ãƒ¼ã‚¹å˜ä½ã§å‡¦ç†
**ææ¡ˆ**: ä¼šå ´å˜ä½ã§å…¨ãƒ¬ãƒ¼ã‚¹ã‚’ä¸€æ‹¬å–å¾—

```python
# ä¾‹: Boatersã‚µã‚¤ãƒˆã§ä¼šå ´ã®å…¨ãƒ¬ãƒ¼ã‚¹æƒ…å ±ã‚’1ãƒšãƒ¼ã‚¸ã§å–å¾—
tenji_data_all_races = self.boaters_scraper.get_venue_all_races(venue_code, target_date)

for race_number, tenji_data in tenji_data_all_races.items():
    self._save_tenji_to_db(...)
```

**åŠ¹æœ**:
- HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆæ•°å‰Šæ¸›
- ãƒ–ãƒ©ã‚¦ã‚¶æ“ä½œå›æ•°å‰Šæ¸›
- æ¨å®š: 60ãƒ¬ãƒ¼ã‚¹ â†’ **3-5åˆ†**ï¼ˆ80-90%çŸ­ç¸®ï¼‰

**å·¥æ•°**: ä¸­ç¨‹åº¦ï¼ˆã‚¹ã‚¯ãƒ¬ã‚¤ãƒ‘ãƒ¼ã®æ”¹ä¿®ãŒå¿…è¦ï¼‰

---

#### B-2. ä¸¦åˆ—å‡¦ç†ã®å°å…¥

**ææ¡ˆ**: è¤‡æ•°ã®ä¼šå ´ã‚’ä¸¦åˆ—ã§å‡¦ç†

```python
from concurrent.futures import ThreadPoolExecutor

with ThreadPoolExecutor(max_workers=3) as executor:
    futures = []
    for venue_code, venue_races in venues_dict.items():
        future = executor.submit(self._collect_venue, venue_code, venue_races)
        futures.append(future)

    for future in futures:
        result = future.result()
```

**åŠ¹æœ**:
- 3ä¼šå ´ä¸¦åˆ—: æ¨å®š**60-70%çŸ­ç¸®**

**æ³¨æ„**:
- ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ãƒãƒŠãƒ¼ï¼ˆåŒä¸€ã‚µãƒ¼ãƒãƒ¼ã¸ã®ä¸¦åˆ—ã‚¢ã‚¯ã‚»ã‚¹ã¯é¿ã‘ã‚‹ï¼‰
- ç•°ãªã‚‹ä¼šå ´ï¼ˆç•°ãªã‚‹ã‚µãƒ¼ãƒãƒ¼ï¼‰ã®ã¿ä¸¦åˆ—åŒ–

---

### å„ªå…ˆåº¦C: é•·æœŸçš„ãªæ”¹å–„

#### C-1. ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ©Ÿæ§‹ã®å°å…¥

- åŒã˜ãƒ¬ãƒ¼ã‚¹ã®ãƒ‡ãƒ¼ã‚¿ã‚’è¤‡æ•°å›å–å¾—ã—ãªã„
- å–å¾—æ¸ˆã¿ãƒ‡ãƒ¼ã‚¿ã‚’DB/ãƒ¡ãƒ¢ãƒªã«ä¿å­˜

#### C-2. å·®åˆ†åé›†

- æ—¢ã«DBã«ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚‹ãƒ¬ãƒ¼ã‚¹ã¯ã‚¹ã‚­ãƒƒãƒ—
- æ›´æ–°ãŒå¿…è¦ãªãƒ¬ãƒ¼ã‚¹ã®ã¿å–å¾—

---

## ğŸ“‹ æ¨å¥¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³

### å³åº§ã«å®Ÿè¡Œå¯èƒ½

1. **A-1: ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆçŸ­ç¸®** (5åˆ†ã§å®Ÿè£…å¯èƒ½)
   ```python
   # src/workflow/tenji_collection.py:117
   collector = UnifiedTenjiCollector(headless=True, timeout=5)
   ```

2. **A-2ã®ãƒ•ãƒ©ã‚°è¿½åŠ ** (10åˆ†ã§å®Ÿè£…å¯èƒ½)
   - `TenjiCollectionWorkflow.run()`ã«`fast_mode=True`ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿è¿½åŠ 
   - `fast_mode=True`ã®å ´åˆã€Boatersã‚µã‚¤ãƒˆã®ã¿è©¦è¡Œ

### å‹•ä½œç¢ºèªå¾Œã«æ¤œè¨

3. **A-3: ãƒ–ãƒ©ã‚¦ã‚¶å†åˆ©ç”¨ã®ç¢ºèªãƒ»æ”¹å–„**
   - ä¸¡ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ‘ãƒ¼ã®ã‚³ãƒ¼ãƒ‰èª¿æŸ»
   - å¿…è¦ã«å¿œã˜ã¦ä¿®æ­£

### ä¸­æœŸçš„ã«å®Ÿè£…

4. **B-1: ä¼šå ´å˜ä½ã®ãƒãƒƒãƒå‡¦ç†**
   - æœ€ã‚‚åŠ¹æœçš„ã ãŒå·¥æ•°ãŒå¤§ãã„
   - ãƒ‡ãƒ¼ã‚¿å–å¾—ç‡ã‚‚ç¶­æŒã§ãã‚‹

---

## ğŸ¯ æœŸå¾…åŠ¹æœã¾ã¨ã‚

| æ”¹å–„æ¡ˆ | åŠ¹æœ | å·¥æ•° | ãƒªã‚¹ã‚¯ |
|--------|------|------|--------|
| A-1: ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆçŸ­ç¸® | **66%çŸ­ç¸®** | 5åˆ† | ä½ |
| A-2: ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ç„¡åŠ¹åŒ– | **75%çŸ­ç¸®** | 10åˆ† | ä¸­ |
| A-3: ãƒ–ãƒ©ã‚¦ã‚¶å†åˆ©ç”¨ | 20-40%çŸ­ç¸® | 30åˆ† | ä½ |
| B-1: ä¼šå ´ãƒãƒƒãƒå‡¦ç† | **80-90%çŸ­ç¸®** | 2-3æ™‚é–“ | ä½ |
| B-2: ä¸¦åˆ—å‡¦ç† | 60-70%çŸ­ç¸® | 1æ™‚é–“ | ä¸­ |

### çµ„ã¿åˆã‚ã›ä¾‹

**A-1 + A-2 + A-3**:
- æ¨å®šåŠ¹æœ: **85-90%çŸ­ç¸®** (30åˆ† â†’ 3-4.5åˆ†)
- å·¥æ•°: 45åˆ†
- ãƒªã‚¹ã‚¯: ä¸­ï¼ˆãƒ‡ãƒ¼ã‚¿å–å¾—ç‡ä½ä¸‹ã®å¯èƒ½æ€§ï¼‰

**A-1 + B-1**:
- æ¨å®šåŠ¹æœ: **90-95%çŸ­ç¸®** (30åˆ† â†’ 1.5-3åˆ†)
- å·¥æ•°: 2-3æ™‚é–“
- ãƒªã‚¹ã‚¯: ä½ï¼ˆæœ€ã‚‚æ¨å¥¨ï¼‰

---

## é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«

- [src/workflow/tenji_collection.py](../src/workflow/tenji_collection.py) - ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼æœ¬ä½“
- [src/scraper/unified_tenji_collector.py](../src/scraper/unified_tenji_collector.py) - çµ±åˆã‚³ãƒ¬ã‚¯ã‚¿ãƒ¼
- [src/scraper/original_tenji_browser.py](../src/scraper/original_tenji_browser.py) - Boatersã‚¹ã‚¯ãƒ¬ã‚¤ãƒ‘ãƒ¼
- [src/scraper/venue_tenji_scraper.py](../src/scraper/venue_tenji_scraper.py) - å„å ´å…¬å¼HPã‚¹ã‚¯ãƒ¬ã‚¤ãƒ‘ãƒ¼
- [scripts/worker_tenji_collection.py](../scripts/worker_tenji_collection.py) - ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ãƒ¯ãƒ¼ã‚«ãƒ¼
