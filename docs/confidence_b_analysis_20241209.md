# 信頼度B活用方法の検討結果

**分析日**: 2025年12月9日
**対象期間**: 2024年1月1日～2025年12月31日
**分析スクリプト**: `scripts/analyze_confidence_b_v2.py`
**詳細データ**: `results/confidence_b_analysis_20241209_102627.csv`

---

## 📊 基本統計（2024-2025年）

### 全体サマリー

| 項目 | 値 |
|------|-----|
| **総レース数** | 1,614レース |
| **的中数** | 109回 |
| **的中率** | **6.75%** |
| **全レース購入時のROI** | **75.4%**（マイナス） |
| **収支** | **-119,280円** |

### 年別推移

| 年 | レース数 | 的中数 | 的中率 |
|----|----------|--------|--------|
| 2024年 | 142 | 7 | **4.93%** |
| 2025年 | 1,472 | 102 | **6.93%** |

### 📌 重要な問題点

#### 🔴 **的中率が極めて低い（6.75%）**

**他の信頼度との比較が必要：**
- 信頼度A: ?%
- 信頼度B: **6.75%** ← 今回分析
- 信頼度C: ?%
- 信頼度D: 8.2%（既存実績）

**考えられる原因：**
1. **信頼度判定ロジックの問題**
   - Bランクの閾値が適切でない可能性
   - スコアリングが不正確

2. **予測精度の問題**
   - 1位予想の精度が低い
   - 2位・3位の予想精度も低い（三連単的中に必要）

3. **データ品質の問題**
   - 2024年のデータが少ない（142レース）
   - 2025年で改善傾向（4.93% → 6.93%）

---

## 💡 発見された収益化可能な条件

### ✅ **戦略1: A2級 × オッズ20-150倍**

| 条件 | レース数 | 的中数 | 的中率 | ROI | 収支 |
|------|----------|--------|--------|-----|------|
| **A2級 × 100-150倍** | 15 | 2 | 13.3% | **1580.7%** | +66,630円 |
| **A2級 × 20-30倍** | 49 | 6 | 12.2% | **316.7%** | +31,860円 |
| **合計** | **64** | **8** | **12.5%** | **613.0%** | **+98,490円** |

#### 戦略1の評価

**✅ 長所：**
- ROI 613%（6倍超）は魅力的
- 的中率12.5%（全体6.75%の**1.85倍**）
- サンプル数64レース（2年間）

**⚠️ 懸念点：**
1. **サンプル数が少ない（64レース / 2年 = 年間32レース）**
   - 月間約2.7レース
   - 統計的信頼性が低い可能性

2. **過学習のリスク**
   - A2級 × 100-150倍は**わずか15レース**
   - たまたま2回当たっただけの可能性

3. **的中率12.5%でも低い**
   - 8レース購入して1回的中
   - 外れが7回連続する可能性もある

---

## 📈 級別×オッズレンジのクロス集計

### ROI 100%以上の条件

| 級別 | オッズレンジ | レース数 | 的中数 | 的中率 | ROI |
|------|-------------|----------|--------|--------|-----|
| A2 | 100-150倍 | **15** | 2 | 13.3% | **1580.7%** |
| A2 | 20-30倍 | **49** | 6 | 12.2% | **316.7%** |

### ROI 80%以上100%未満（ほぼ収支トントン）

| 級別 | オッズレンジ | レース数 | 的中数 | 的中率 | ROI |
|------|-------------|----------|--------|--------|-----|
| B1 | 5-10倍未満 | 21 | 2 | 9.5% | 88.1% |
| A2 | 5-10倍未満 | 181 | 23 | 12.7% | 80.8% |

### A1級の状況（レース数最多）

| オッズレンジ | レース数 | 的中数 | 的中率 | ROI |
|-------------|----------|--------|--------|-----|
| **5-10倍未満** | **449** | 54 | 12.0% | 72.7% |
| 10-20倍 | 293 | 12 | 4.1% | 54.4% |
| 30-50倍 | 90 | 2 | 2.2% | 66.8% |
| 20-30倍 | 112 | 1 | 0.9% | 19.8% |

**A1級の問題：**
- サンプル数は多い（1,063レース）
- しかし**すべてのオッズレンジで赤字**
- 低オッズ（5-10倍未満）でも的中率12%で収支マイナス

---

## 🏟️ 会場特性別の分析

### 会場タイプ別ROI

| 会場タイプ | レース数 | 的中率 | 平均オッズ | ROI |
|-----------|----------|--------|-----------|-----|
| **普通** | 235 | 4.3% | 59.0倍 | **99.9%** |
| **イン強** | 987 | 7.8% | 18.9倍 | 79.6% |
| **超イン強** | 392 | 5.6% | 23.4倍 | 49.9% |

### 会場タイプ×級別のクロス集計

#### ROI 100%以上の組み合わせ

| 会場タイプ | 級別 | レース数 | 的中数 | 的中率 | ROI | 収支 |
|-----------|------|----------|--------|--------|-----|------|
| **普通** | **A2** | **65** | 5 | 7.7% | **300.8%** | **+39,150円** |
| **イン強** | **A2** | **292** | 24 | 8.2% | **119.3%** | **+16,950円** |

#### A1級の状況

| 会場タイプ | レース数 | 的中数 | 的中率 | ROI |
|-----------|----------|--------|--------|-----|
| イン強 | 666 | 52 | 7.8% | 64.2% |
| 普通 | 165 | 5 | 3.0% | 23.8% |
| 超イン強 | 232 | 12 | 5.2% | 43.6% |

**全会場タイプで赤字**

---

## 🔍 的中レースの特徴分析

### 的中 vs 不的中の数値比較

| 特徴 | 的中平均 | 不的中平均 | 差分 | 考察 |
|------|----------|------------|------|------|
| **predicted_odds** | **11.16** | **26.66** | **-15.50** | 的中レースは低オッズ |
| total_score | 65.64 | 66.40 | -0.76 | スコア差はほぼない |
| course_score | 15.35 | 15.51 | -0.16 | ほぼ同じ |
| racer_score | 26.12 | 26.47 | -0.35 | ほぼ同じ |
| motor_score | 12.64 | 12.65 | -0.02 | ほぼ同じ |
| course_1_win_rate | 56.15 | 55.84 | +0.32 | ほぼ同じ |

**重要な発見：**
- **的中レースは予想オッズが低い**（11倍 vs 27倍）
- しかし**スコアに差がない**（65.64 vs 66.40）
- → **スコアリングロジックが機能していない可能性**

### 級別の分布

#### 的中レース（109回）

| 級別 | 回数 | 割合 |
|------|------|------|
| A1 | 69 | 63.3% |
| A2 | 38 | 34.9% |
| B1 | 2 | 1.8% |

#### 不的中レース（1,505回）

| 級別 | 回数 | 割合 |
|------|------|------|
| A1 | 994 | 66.0% |
| A2 | 446 | 29.6% |
| B1 | 62 | 4.1% |
| B2 | 3 | 0.2% |

**A1とA2の的中率：**
- A1: 69 / (69 + 994) = **6.49%**
- A2: 38 / (38 + 446) = **7.85%**
- B1: 2 / (2 + 62) = **3.13%**

**A2級の方が的中率が高い（+1.36pt）**

### オッズレンジの分布

#### 的中レース（109回）

| オッズレンジ | 回数 | 割合 |
|-------------|------|------|
| **5-10倍未満** | **79** | **72.5%** |
| 10-20倍 | 19 | 17.4% |
| 20-30倍 | 7 | 6.4% |
| 100-150倍 | 2 | 1.8% |
| 30-50倍 | 2 | 1.8% |

**的中の7割以上が低オッズ（5-10倍未満）**

---

## 📝 提案された戦略とバックテスト結果

### 戦略1: A2級 × オッズ20-150倍

```
購入条件:
- 信頼度: B
- トップ予想艇の級別: A2級
- 予想オッズ: 20倍以上150倍以下
```

**バックテスト結果（2024-2025年）：**
- 対象レース: 64レース
- 的中数: 8回
- 的中率: 12.5%
- ROI: **613.0%**
- 収支: **+98,490円**

### 戦略2: total_score上位30%（≥70.1）

**バックテスト結果：**
- 対象レース: 492レース
- 的中数: 26回
- 的中率: 5.28%
- ROI: 74.1%
- 収支: -38,280円（❌赤字）

### 戦略3: A1級 × total_score上位30%

**バックテスト結果：**
- 対象レース: 324レース
- 的中数: 17回
- 的中率: 5.25%
- ROI: 43.8%
- 収支: -54,630円（❌赤字）

---

## ⚠️ リスク分析と懸念点

### 1. **的中率が極めて低い（6.75%）**

**問題点：**
- 三連単15回に1回しか当たらない
- 他の信頼度と比較して妥当性を検証する必要がある
- 信頼度判定ロジック自体の見直しが必要かもしれない

**調査すべきこと：**
```bash
# 他の信頼度の的中率を比較
python scripts/analyze_all_confidence_levels.py
```

### 2. **過学習のリスク（サンプル数不足）**

**戦略1の懸念：**
- A2級 × 100-150倍: **15レースのみ**
- A2級 × 20-30倍: 49レース

**統計的信頼性：**
- 15レースで2回的中 → 的中率13.3%
- しかし95%信頼区間は**1.6% ～ 38.5%**（非常に広い）
- 実運用では0%～40%の範囲でブレる可能性

### 3. **A1級がすべて赤字**

**問題点：**
- A1級は1,063レース（全体の66%）
- どのオッズレンジでも収支マイナス
- A1級の1位予想精度が低い

**考えられる原因：**
- A1級は人気になりやすく、オッズが低い
- 低オッズでも的中率が伴わない
- A1級の信頼度B判定が甘い可能性

### 4. **スコアリングが機能していない**

**問題点：**
- 的中レースと不的中レースでtotal_scoreの差が**わずか0.76点**
- スコアで購入判定できない

**再調査が必要：**
- 信頼度A/B/C/D/Eのスコア分布を確認
- 信頼度判定閾値の見直し

---

## 🎯 推奨アクション

### 📌 **実装は保留（別ウインドウで予測ロジック修正中のため）**

### 1. **信頼度全体の再調査（最優先）**

```bash
# 信頼度A～Eの基本統計
python scripts/analyze_all_confidence_levels.py

# 出力項目:
# - 各信頼度のレース数、的中率、ROI
# - スコア分布
# - 信頼度判定閾値の妥当性
```

**確認すべきこと：**
- 信頼度A: 的中率 ?%
- 信頼度B: 的中率 6.75%（今回）
- 信頼度C: 的中率 ?%
- 信頼度D: 的中率 8.2%（既存）
- 信頼度E: 的中率 ?%

**期待される結果：**
- A > B > C > D > E の順に的中率が下がるはず
- もしBが異常に低ければ、判定ロジックの問題

### 2. **信頼度B判定ロジックの見直し**

現在の判定基準を確認：
```python
# src/analysis/race_predictor.py
# 信頼度判定の閾値を確認
```

**検証項目：**
- total_scoreの閾値は適切か？
- top_probの閾値は適切か？
- 他のスコアも使っているか？

### 3. **1位予想精度の検証**

```bash
# 1位予想の精度を信頼度別に分析
python scripts/analyze_rank1_accuracy.py
```

**確認すべきこと：**
- 1位予想が実際に1位になる確率（信頼度別）
- 1～3位に入る確率（信頼度別）

### 4. **戦略1の慎重な評価**

**もし実装するなら：**

1. **条件を厳しくする**
   - A2級 × 20-30倍のみ（49レース、ROI 316.7%）
   - サンプル数が比較的多い

2. **段階的導入**
   - 最初は賭け金100円で様子見
   - 1ヶ月運用して収支を確認

3. **損切りルール**
   - 10レース連続不的中で一時停止
   - ROI 80%を下回ったら停止

---

## 📊 比較：既存の信頼度C/D戦略

### 既存の運用戦略（2025年実績）

| 信頼度 | 主要条件 | ROI | 年間収支 |
|--------|---------|-----|----------|
| **C** | B1 × 150-200倍 | 376.3% | 一部のみ採用 |
| **D** | B1 × 200-300倍 | **838.4%** | 年間購入の主力 |
| **D** | A1 × 100-150倍 | 396.6% | - |
| **D** | A1 × 40-50倍 | 488.9% | - |

**全体実績：**
- ROI: 298.9%
- 年間収支: +380,070円
- 的中率: 8.2%

### 信頼度Bとの比較

| 項目 | 信頼度B（新） | 信頼度C/D（既存） |
|------|-------------|------------------|
| 的中率 | **6.75%**（全体） | **8.2%** |
| 的中率 | 12.5%（A2×20-150倍） | - |
| ROI | 613.0%（A2×20-150倍） | 298.9%（全体） |
| サンプル数 | 64レース / 2年 | 637レース / 1年 |
| 信頼性 | **⚠️ 低い** | **✅ 高い** |

---

## 🔬 追加で調査すべきこと

### 1. 信頼度別の詳細分析

```bash
# 全信頼度の比較分析
python scripts/analyze_all_confidence_levels.py

# 期待される出力:
# - 各信頼度のレース数
# - 的中率（1位、2位、3位、三連単）
# - スコア分布
# - ROI分布
```

### 2. 2位・3位の予想精度

```bash
# 2位・3位予想の精度分析
python scripts/analyze_rank23_accuracy.py

# 確認項目:
# - 2位予想が実際に2位になる確率
# - 3位予想が実際に3位になる確率
# - 三連単的中率への影響
```

### 3. A1級の問題調査

```bash
# A1級の詳細分析
python scripts/analyze_confidence_b_a1_detail.py

# 確認項目:
# - A1級の信頼度B判定が甘すぎないか？
# - 人気A1級（低オッズ）vs 穴A1級（高オッズ）の違い
# - 会場特性との相互作用
```

### 4. 時系列での変化

```bash
# 月別の的中率推移
python scripts/analyze_confidence_b_monthly.py

# 確認項目:
# - 2024年 4.93% → 2025年 6.93% の改善要因
# - 月別のブレ幅
# - 季節性の有無
```

---

## 📁 関連ファイル

- **分析スクリプト**: `scripts/analyze_confidence_b_v2.py`
- **分析結果（テキスト）**: `results/confidence_b_analysis_20241209.txt`
- **分析結果（CSV）**: `results/confidence_b_analysis_20241209_102627.csv`
- **このドキュメント**: `docs/confidence_b_analysis_20241209.md`

---

## 🚨 結論

### ✅ 発見されたこと

1. **A2級 × オッズ20-150倍**でROI 613%の可能性
2. **普通会場 × A2級**でROI 300.8%の可能性
3. **A2級はA1級より的中率が高い**（7.85% vs 6.49%）

### ⚠️ 懸念点

1. **全体的中率が異常に低い（6.75%）**
   - 信頼度判定ロジックの問題の可能性
   - 他の信頼度と比較検証が必要

2. **サンプル数不足（過学習リスク）**
   - A2×100-150倍はわずか15レース
   - 統計的信頼性が低い

3. **A1級がすべて赤字**
   - 最大のボリュームゾーンで機能していない
   - 判定基準の見直しが必要

### 📌 推奨事項

**今すぐ実装はしない（別ウインドウで予測ロジック修正中）**

**次のステップ：**
1. 信頼度A～Eの全体分析（的中率比較）
2. 信頼度B判定ロジックの見直し
3. 1位・2位・3位の予想精度検証
4. サンプル数が増えてから再評価（2026年末）

**もし実装するなら：**
- A2級 × 20-30倍のみ（サンプル49レース）
- 賭け金100円で試験運用
- 10レース連続不的中で停止

---

**作成日**: 2025年12月9日
**作成者**: Claude Code (Sonnet 4.5)
**ステータス**: 分析完了、実装保留
