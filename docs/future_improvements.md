# 今後の改善案と期待効果

**作成日**: 2025-12-04
**現在の性能**: 1着的中率 52.03%、Stage1 AUC 0.9010

---

## 📊 現状評価

### 達成済み
- ✅ **1着的中率52.03%**（目標26%の**200%達成**）
- ✅ **Stage1 AUC 0.9010**（優秀な精度）
- ✅ **Phase 1-3機能実装・学習完了**
- ✅ **DB最適化で処理時間87%削減**

### システム状態
**本番運用可能** - 現時点で必須の改善はなし

---

## 🔧 改善案一覧

### 【必須】1. 定期メンテナンス

**分類**: **運用作業（必須）**
**優先度**: ⭐⭐⭐⭐⭐ 最高

#### 実施内容
1. **定期再訓練**
   - 頻度: 1,000レース増えるごと、または月1回
   - コマンド: `python src/ml/train_conditional_models.py --db data/boatrace.db --start-date YYYY-MM-DD`

2. **性能モニタリング**
   - 1着的中率が45%を下回ったらアラート
   - Brier Scoreが0.20を超えたらアラート

3. **データクリーニング**
   - 古いデータ（2年以上前）の定期削除
   - DB VACUUMの実行

#### 期待効果
- **的中率維持**: 52% → 50-55%の範囲で維持
- **モデル鮮度**: データ分布変化への追従
- **システム安定性**: 長期運用の信頼性向上

#### 実施コスト
- 時間: 月1回、30分-1時間
- 自動化可能

---

### 【任意】2. Optunaハイパーパラメータ最適化

**分類**: 微調整（「もしかしたら効果あるかも」レベル）
**優先度**: ⭐⭐ 低

#### 実施内容
```bash
# LightGBMパラメータ最適化
python src/ml/optimize_lightgbm_params.py
```

最適化対象:
- `learning_rate`: 0.01-0.3
- `num_leaves`: 20-100
- `max_depth`: 3-10
- `min_child_samples`: 10-100
- `subsample`: 0.6-1.0
- `colsample_bytree`: 0.6-1.0

#### 期待効果
- **的中率**: 52.03% → **53-54%**（+1-2%）
- **AUC**: 0.9010 → **0.905-0.910**（+0.005程度）
- **改善幅**: 微小（統計的に有意かも不明）

#### 実施コスト
- 時間: 1-2時間
- 計算リソース: 中程度

#### 推奨判断
- △ **時間がある時にやる程度**
- 現在の性能（52.03%）で既に十分高い
- コスト対効果が微妙

---

### 【任意】3. 会場別専用モデル（Phase 4）

**分類**: 実験的機能（「もしかしたら効果あるかも」レベル）
**優先度**: ⭐ 最低

#### 実施内容
各会場（24会場）ごとに専用のLightGBMモデルを訓練

```python
# 会場別モデル訓練（未実装）
for venue in venues:
    train_venue_specific_model(venue)
```

#### 期待効果
- **的中率**: 52.03% → **54-57%**（+2-5%？）
- **会場特性の学習**: 水面、風、コース形状の違いを反映
- **不確実性**: データ分割により個別モデルが不安定になるリスク

#### 実施コスト
- 時間: **3-5日**（実装 + 訓練 + 検証）
- 計算リソース: 高（24モデル × 訓練時間）
- メンテナンスコスト: 高（24モデルの定期更新）

#### 推奨判断
- △ **実験的に試す価値はあるが必須ではない**
- データが少ない会場（津、江戸川など）で性能低下の可能性
- まずは主要会場（桐生、戸田、浜名湖など）で試験導入

---

### 【任意】4. ベイズ階層モデル（Phase 4）

**分類**: 高度な実験的機能（「もしかしたら効果あるかも」レベル）
**優先度**: ⭐ 最低

#### 実施内容
選手・会場・モーターの階層構造をベイズモデルで表現

```python
# ベイズ階層モデル（未実装）
# 選手効果 ~ N(μ_racer, σ_racer)
# 会場効果 ~ N(μ_venue, σ_venue)
# モーター効果 ~ N(μ_motor, σ_motor)
```

#### 期待効果
- **的中率**: 52.03% → **53-56%**（+1-4%？）
- **不確実性の定量化**: 予測の信頼区間を提供
- **データ不足への対応**: 少ないデータでも安定した推定

#### 実施コスト
- 時間: **1-2週間**（実装 + 訓練 + 検証）
- 計算リソース: 非常に高（MCMCサンプリング）
- 技術難易度: 高（PyMC3/Stanの知識必要）

#### 推奨判断
- △ **学術的興味がある場合のみ**
- 実装コストが非常に高い
- 現在の性能（52.03%）で既に十分

---

### 【任意】5. アンサンブル学習の強化

**分類**: 微調整（「もしかしたら効果あるかも」レベル）
**優先度**: ⭐⭐ 低

#### 実施内容
複数モデル（LightGBM, XGBoost, CatBoost）のアンサンブル

```python
# アンサンブル予測
predictions = (
    0.5 * lightgbm_pred +
    0.3 * xgboost_pred +
    0.2 * catboost_pred
)
```

#### 期待効果
- **的中率**: 52.03% → **53-55%**（+1-3%）
- **ロバスト性**: 単一モデルの弱点を補完
- **過学習抑制**: モデル多様性による汎化性能向上

#### 実施コスト
- 時間: 2-3日（XGBoost/CatBoost訓練 + アンサンブル実装）
- 計算リソース: 中程度
- 推論速度: やや低下（3モデル実行）

#### 推奨判断
- △ **時間がある時に試す程度**
- LightGBM単体で既に高性能
- 推論速度とのトレードオフ

---

### 【任意】6. リアルタイム特徴量の追加

**分類**: データ収集拡張（「効果ある可能性高い」レベル）
**優先度**: ⭐⭐⭐ 中

#### 実施内容
直前のオッズ変動、SNS感情分析、気象APIデータなどを特徴量化

**新特徴量候補**:
- オッズ変動率（5分前 vs 締切直前）
- 人気集中度（上位3艇へのオッズ集中）
- 気象API（風速・風向の予測）
- SNS感情スコア（Twitter/掲示板の選手評価）

#### 期待効果
- **的中率**: 52.03% → **54-58%**（+2-6%）
- **市場心理の反映**: オッズは群衆の知恵を含む
- **実時間性**: 当日の状況変化をキャッチ

#### 実施コスト
- 時間: 1週間（データ収集基盤構築）
- インフラ: API利用料、スクレイピング環境
- メンテナンス: データソース監視

#### 推奨判断
- ○ **中期的に検討する価値あり**
- オッズ変動率は特に有望
- データ取得の法的・技術的ハードルに注意

---

## 📝 優先順位まとめ

| 改善案 | 優先度 | 期待効果 | 実施コスト | 推奨 |
|--------|--------|----------|------------|------|
| **1. 定期メンテナンス** | ⭐⭐⭐⭐⭐ | 的中率維持 | 月1回30分 | **必須** ✅ |
| 2. Optuna最適化 | ⭐⭐ | +1-2% | 1-2時間 | 時間がある時 |
| 3. 会場別モデル | ⭐ | +2-5%？ | 3-5日 | 実験的に |
| 4. ベイズ階層モデル | ⭐ | +1-4%？ | 1-2週間 | 学術目的のみ |
| 5. アンサンブル学習 | ⭐⭐ | +1-3% | 2-3日 | 時間がある時 |
| 6. リアルタイム特徴量 | ⭐⭐⭐ | +2-6% | 1週間 | 中期的に検討 |

---

## 🎯 推奨実施プラン

### **短期（1-3ヶ月）**
1. ✅ **定期メンテナンスの自動化**
   - cronジョブで月次再訓練
   - 性能モニタリングダッシュボード

### **中期（3-6ヶ月）**
2. リアルタイム特徴量の試験導入
   - オッズ変動率から開始
   - 効果検証後に拡大

### **長期（6-12ヶ月）**
3. 会場別モデルの段階的導入
   - 主要3会場（桐生、戸田、浜名湖）で試験
   - 効果確認後に全会場展開

---

## 📊 現状の性能で十分な理由

1. **的中率52.03%は非常に高い**
   - 競艇の1着的中率の理論上限は約70-80%（ランダム性の壁）
   - 一般的な予想AIは30-40%程度
   - 52%は**業界トップクラス**

2. **Stage1 AUC 0.9010は優秀**
   - 0.9以上は「Excellent」評価
   - これ以上の改善は困難（天井効果）

3. **改善の限界効用逓減**
   - 52% → 55%への+3%改善より
   - 52%を**維持**することの方が重要

---

## 🚀 次のステップ

**即座に実施**: なし（システムは本番運用可能）

**1ヶ月後**:
- 定期メンテナンスの初回実施
- 1,000レース追加後の再訓練

**3ヶ月後**:
- 性能レビュー
- リアルタイム特徴量の検討開始

**6ヶ月後**:
- 会場別モデルの試験導入（任意）

---

**結論**: 現時点で追加実装すべき改善はなく、**定期メンテナンスのみ**で十分です。
