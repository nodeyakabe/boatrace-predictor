# 気象条件プリセットルール

**作成日**: 2025-12-12
**分析期間**: 2025-11-28 ~ 2025-12-10
**分析対象**: 4,052艇（674-678艇/コース）

---

## ベースライン（全体平均）

| コース | 1着率 | 3連対率 | サンプル数 |
|--------|-------|---------|-----------|
| 1コース | 50.3% | 79.8% | 674 |
| 2コース | 13.8% | 56.9% | 675 |
| 3コース | 16.0% | 56.4% | 677 |
| 4コース | 12.5% | 47.5% | 673 |
| 5コース | 6.5% | 39.5% | 678 |
| 6コース | 2.8% | 25.0% | 675 |

---

## 統計的に有意なパターン（影響度順、上位20件）

### 1. **暴風(8m+) × 4コース: 1着率+20.9%, 3連対率+19.1%** (n=15)
   - **ルール**: 風速8m以上 → **4コース強烈プラス**
   - 1着率: 12.5% → 33.3% (+20.9%)
   - 3連対率: 47.5% → 66.7% (+19.1%)
   - **補正**: スコア +15点

### 2. **暴風(8m+) × 1コース: 1着率-28.9%, 3連対率-1.3%** (n=14)
   - **ルール**: 風速8m以上 → **1コース大幅マイナス**
   - 1着率: 50.3% → 21.4% (-28.9%)
   - 3連対率: 79.8% → 78.6% (-1.3%)
   - **補正**: スコア -20点

### 3. **暴風(8m+) × 2コース: 1着率+12.9%, 3連対率+9.8%** (n=15)
   - **ルール**: 風速8m以上 → **2コースプラス**
   - 1着率: 13.8% → 26.7% (+12.9%)
   - 3連対率: 56.9% → 66.7% (+9.8%)
   - **補正**: スコア +10点

### 4. **暴風(8m+) × 3コース: 1着率-1.7%, 3連対率-13.6%** (n=14)
   - **ルール**: 風速8m以上 → **3コース3連対率大幅マイナス**
   - 1着率: 16.0% → 14.3% (-1.7%)
   - 3連対率: 56.4% → 42.9% (-13.6%)
   - **補正**: スコア -10点

### 5. **曇天 × 2コース: 1着率+8.9%, 3連対率-0.1%** (n=44)
   - **ルール**: 曇天 → **2コース1着率プラス**
   - 1着率: 13.8% → 22.7% (+8.9%)
   - 3連対率: 56.9% → 56.8% (-0.1%)
   - **補正**: スコア +6点

### 6. **温度差小(<2C) × 1コース: 1着率+7.0%, 3連対率+8.4%** (n=110)
   - **ルール**: 気温・水温差2℃未満 → **1コース強烈プラス**
   - 1着率: 50.3% → 57.3% (+7.0%)
   - 3連対率: 79.8% → 88.2% (+8.4%)
   - **補正**: スコア +12点

### 7. **温度差小(<2C) × 5コース: 1着率-4.7%, 3連対率-6.5%** (n=112)
   - **ルール**: 気温・水温差2℃未満 → **5コース大幅マイナス**
   - 1着率: 6.5% → 1.8% (-4.7%)
   - 3連対率: 39.5% → 33.0% (-6.5%)
   - **補正**: スコア -8点

### 8. **強風(6-8m) × 4コース: 1着率+7.0%, 3連対率+8.5%** (n=41)
   - **ルール**: 風速6-8m → **4コースプラス**
   - 1着率: 12.5% → 19.5% (+7.0%)
   - 3連対率: 47.5% → 56.1% (+8.5%)
   - **補正**: スコア +10点

### 9. **無風(<2m) × 3コース: 1着率+4.4%, 3連対率+8.6%** (n=123)
   - **ルール**: 風速2m未満 → **3コース3連対率プラス**
   - 1着率: 16.0% → 20.3% (+4.4%)
   - 3連対率: 56.4% → 65.0% (+8.6%)
   - **補正**: スコア +8点

### 10. **曇天 × 3コース: 1着率-0.0%, 3連対率+7.2%** (n=44)
   - **ルール**: 曇天 → **3コース3連対率プラス**
   - 1着率: 16.0% → 15.9% (-0.0%)
   - 3連対率: 56.4% → 63.6% (+7.2%)
   - **補正**: スコア +5点

### 11. **温度差中(2-5C) × 3コース: 1着率+4.4%, 3連対率+7.1%** (n=211)
   - **ルール**: 気温・水温差2-5℃ → **3コース3連対率プラス**
   - 1着率: 16.0% → 20.4% (+4.4%)
   - 3連対率: 56.4% → 63.5% (+7.1%)
   - **補正**: スコア +7点

### 12. **温度差中(2-5C) × 2コース: 1着率-5.2%, 3連対率-6.9%** (n=210)
   - **ルール**: 気温・水温差2-5℃ → **2コース大幅マイナス**
   - 1着率: 13.8% → 8.6% (-5.2%)
   - 3連対率: 56.9% → 50.0% (-6.9%)
   - **補正**: スコア -8点

### 13. **曇天 × 5コース: 1着率+4.4%, 3連対率+6.8%** (n=110)
   - **ルール**: 曇天 → **5コースプラス**
   - 1着率: 6.5% → 10.9% (+4.4%)
   - 3連対率: 39.5% → 46.4% (+6.8%)
   - **補正**: スコア +7点

### 14. **温度差大(5-8C) × 5コース: 1着率+2.3%, 3連対率+6.1%** (n=114)
   - **ルール**: 気温・水温差5-8℃ → **5コースプラス**
   - 1着率: 6.5% → 8.8% (+2.3%)
   - 3連対率: 39.5% → 45.6% (+6.1%)
   - **補正**: スコア +5点

### 15. **温度差大(5-8C) × 6コース: 1着率-1.1%, 3連対率-6.8%** (n=115)
   - **ルール**: 気温・水温差5-8℃ → **6コース3連対率マイナス**
   - 1着率: 2.8% → 1.7% (-1.1%)
   - 3連対率: 25.0% → 18.3% (-6.8%)
   - **補正**: スコア -5点

### 16. **強風(6-8m) × 2コース: 1着率-6.5%, 3連対率+1.6%** (n=41)
   - **ルール**: 風速6-8m → **2コース1着率マイナス**
   - 1着率: 13.8% → 7.3% (-6.5%)
   - 3連対率: 56.9% → 58.5% (+1.6%)
   - **補正**: スコア -5点

### 17. **強風(6-8m) × 6コース: 1着率+2.4%, 3連対率-6.6%** (n=38)
   - **ルール**: 風速6-8m → **6コース3連対率マイナス**
   - 1着率: 2.8% → 5.3% (+2.4%)
   - 3連対率: 25.0% → 18.4% (-6.6%)
   - **補正**: スコア -5点

### 18. **中風(4-6m) × 1コース: 1着率+4.8%, 3連対率+3.2%** (n=147)
   - **ルール**: 風速4-6m → **1コースプラス**
   - 1着率: 50.3% → 55.1% (+4.8%)
   - 3連対率: 79.8% → 83.0% (+3.2%)
   - **補正**: スコア +5点

### 19. **温度差大(5-8C) × 3コース: 1着率-5.4%, 3連対率-2.9%** (n=114)
   - **ルール**: 気温・水温差5-8℃ → **3コース1着率マイナス**
   - 1着率: 16.0% → 10.5% (-5.4%)
   - 3連対率: 56.4% → 53.5% (-2.9%)
   - **補正**: スコア -5点

### 20. **寒冷(10-15C) × 2コース: 1着率-2.2%, 3連対率-5.0%** (n=181)
   - **ルール**: 気温10-15℃ → **2コース3連対率マイナス**
   - 1着率: 13.8% → 11.6% (-2.2%)
   - 3連対率: 56.9% → 51.9% (-5.0%)
   - **補正**: スコア -4点

---

## プリセットルール適用ロジック

### 優先順位

1. **風速ルール**（影響度大）
2. **温度差ルール**（影響度中）
3. **天候ルール**（影響度中）
4. **気温帯ルール**（影響度小）

### 実装方針

```python
def apply_weather_preset_rules(course: int, weather_data: Dict) -> float:
    """
    気象条件プリセットルールを適用

    Args:
        course: コース番号(1-6)
        weather_data: {
            'wind_speed': float,
            'temperature': float,
            'water_temp': float,
            'weather_condition': str
        }

    Returns:
        補正スコア（-20 ~ +15点）
    """
    score = 0.0

    wind_speed = weather_data.get('wind_speed')
    temperature = weather_data.get('temperature')
    water_temp = weather_data.get('water_temp')
    weather_condition = weather_data.get('weather_condition', '')

    # === 1. 風速ルール（最優先） ===
    if wind_speed is not None:
        if wind_speed >= 8.0:  # 暴風
            if course == 1:
                score -= 20.0  # 1コース大幅マイナス
            elif course == 2:
                score += 10.0  # 2コースプラス
            elif course == 3:
                score -= 10.0  # 3コースマイナス
            elif course == 4:
                score += 15.0  # 4コース強烈プラス

        elif wind_speed >= 6.0:  # 強風
            if course == 2:
                score -= 5.0   # 2コースマイナス
            elif course == 4:
                score += 10.0  # 4コースプラス
            elif course == 6:
                score -= 5.0   # 6コースマイナス

        elif wind_speed >= 4.0:  # 中風
            if course == 1:
                score += 5.0   # 1コースプラス

        elif wind_speed < 2.0:  # 無風
            if course == 3:
                score += 8.0   # 3コースプラス

    # === 2. 温度差ルール ===
    if temperature is not None and water_temp is not None:
        temp_diff = abs(temperature - water_temp)

        if temp_diff < 2.0:  # 小
            if course == 1:
                score += 12.0  # 1コース強烈プラス
            elif course == 5:
                score -= 8.0   # 5コースマイナス

        elif temp_diff >= 2.0 and temp_diff < 5.0:  # 中
            if course == 2:
                score -= 8.0   # 2コースマイナス
            elif course == 3:
                score += 7.0   # 3コースプラス

        elif temp_diff >= 5.0 and temp_diff < 8.0:  # 大
            if course == 3:
                score -= 5.0   # 3コースマイナス
            elif course == 5:
                score += 5.0   # 5コースプラス
            elif course == 6:
                score -= 5.0   # 6コースマイナス

    # === 3. 天候ルール ===
    if '曇' in weather_condition:
        if course == 2:
            score += 6.0   # 2コースプラス
        elif course == 3:
            score += 5.0   # 3コースプラス
        elif course == 5:
            score += 7.0   # 5コースプラス

    # === 4. 気温帯ルール ===
    if temperature is not None:
        if temperature >= 10.0 and temperature < 15.0:  # 寒冷
            if course == 2:
                score -= 4.0   # 2コースマイナス

    # 5点満点に正規化（元々10点→5点に半減）
    return min(max(score * 0.5, -10.0), 7.5)
```

---

## 重要な発見

### 1. **風速が最も影響度が大きい**
   - 暴風(8m+)では1コース勝率が50% → 21%に激減
   - 逆に4コースは12% → 33%に急上昇
   - **風速8m以上は特別扱いが必要**

### 2. **温度差小(<2℃)は1コース超有利**
   - 1着率+7.0%、3連対率+8.4%
   - 気温・水温が近い = 安定条件 → インコース有利

### 3. **曇天は2コース・3コース・5コースに有利**
   - 視界条件の変化が影響？
   - サンプル数も十分(44-110件)

### 4. **気温帯単独の影響は小さい**
   - 差分±3%程度
   - 補助的要因として扱う

---

## 次のステップ

1. **プリセットルール実装**
   - `src/analysis/weather_preset_adjuster.py` を新規作成
   - BeforeInfoScorerから呼び出し

2. **バックテストで効果検証**
   - プリセットルールあり vs なし
   - 精度改善を確認

3. **より多くのデータで検証**
   - 2025年通年データで再検証
   - 会場別の傾向分析
