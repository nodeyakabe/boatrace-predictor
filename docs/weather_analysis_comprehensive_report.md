# 気象情報の総合分析レポート

**作成日**: 2025-12-12
**分析期間**: 2025-01-01 ~ 2025-12-31
**目的**: 気象情報（風速・風向・波高）の予測への影響度を定量化し、実装方針を決定する

---

## エグゼクティブサマリー

### 実装した補正

1. **会場×風向×風速補正** ✅
   - 対象: 暴風時（8m以上）×1コース
   - 補正範囲: -20.0 ~ +20.0点
   - パターン数: 15パターン（10会場×1-2風向）

2. **波高補正** ✅
   - 対象: 高波時（10cm以上）×1-2コース
   - 補正範囲: -10.0 ~ +5.0点
   - 補正区分: 10-14cm（最大）、15cm以上（やや）

### 不採用となった補正

- **風速のみのシンプル補正**: 会場×風向で最大91.7ptの差があり、風速のみでは不十分
- **会場×波高補正**: サンプル数の偏り（江戸川94.6%）、会場依存性が弱い

---

## 1. 風速×風向×会場の分析

### 1.1 データ概要

- **分析期間**: 2025-01-01 ~ 2025-12-31
- **暴風レース数**: 264レース（8m以上）
- **ベースライン**: 1コース勝率 56.3% (9448/16780艇)
- **データ完全性**: 92.6%（16,123/17,407レース）

### 1.2 主要な発見

#### 会場×風向の影響は極端

| パターン | 会場 | 風向 | 勝率 | 差分 | サンプル |
|----------|------|------|------|------|----------|
| 超有利 | 13（尼崎） | 西 | 91.7% | +35.4pt | 12艇 |
| 超有利 | 19（下関） | 北北東 | 90.9% | +34.6pt | 11艇 |
| 超有利 | 23（唐津） | 西 | 90.9% | +34.6pt | 11艇 |
| 極端不利 | 14（三国） | 東北東 | 0.0% | -56.3pt | 6艇 |
| 大幅不利 | 02（戸田） | 北 | 25.0% | -31.3pt | 12艇 |
| 大幅不利 | 10（桐生） | 西 | 33.3% | -23.0pt | 30艇 |

**結論**: 会場×風向の組み合わせで最大91.7pt（尼崎西風 vs 三国東北東）の差がある

#### 風速区分による違い（桐生×西風のケース）

| 風速範囲 | 1コース勝率 | サンプル |
|----------|-------------|----------|
| 8.0-8.5m | 0.0% | 2艇 |
| 9.0-9.5m | 23.1% | 13艇 |
| 10.0m+ | 46.7% | 15艇 |

→ 桐生×西風は風速が強いほど1コース勝率が回復（特異なパターン）

### 1.3 実装方針

**採用**: 会場×風向の補正テーブル

```python
VENUE_WIND_DIRECTION_ADJUSTMENT = {
    '02': {'北': -31.3, '南東': -18.8},      # 戸田
    '03': {'東': -8.2},                      # 江戸川
    '04': {'東南東': -6.3},                  # 平和島
    '08': {'北北西': +3.7, '西北西': -1.8},  # 常滑
    '10': {'西': -23.0},                     # 桐生
    '13': {'西': +35.4, '北': +10.4},        # 尼崎
    '14': {'東南東': -19.9, '東北東': -56.3}, # 三国
    '15': {'西南西': +2.0},                  # 丸亀
    '19': {'北北東': +34.6},                 # 下関
    '23': {'西': +34.6, '東': +3.7},         # 唐津
}
```

**適用条件**:
- 風速: 8m以上（暴風時のみ）
- 対象コース: 1コースのみ
- スコア換算: 差分の50%を適用

**不採用の理由**（風速のみのシンプル補正）:
- 会場×風向で最大91.7ptの差があり、風速のみでは会場特性を無視
- 追い風・向かい風の概念では不十分（実データドリブンが必要）

### 1.4 データ検証の課題

#### 問題1: 会場14の風向データ

- **初期分析**: 西北東 -22.9pt
- **通年データ検証**: 西北東の風向データが存在しない
- **正しいデータ**: 東北東 -56.3pt (0.0%, 0/6艇)

#### 問題2: 会場19の風向データ

- **初期分析**: 北北西 +34.6pt
- **バイト列検証**: `e58c97e58c97e69db1` = 「北北東」
- **正しいデータ**: 北北東 +34.6pt (90.9%, 10/11艇)

#### 問題3: 文字化け

- **原因**: Windowsコンソールの文字コード（CP932）
- **解決**: バイト列を直接確認

---

## 2. 波高の分析

### 2.1 データ概要

- **分析期間**: 2025-01-01 ~ 2025-12-31
- **高波レース数**: 332レース（10cm以上）
- **ベースライン**: 1コース勝率 56.4%
- **データ完全性**: 93.0%（16,136/17,407レース）

### 2.2 主要な発見

#### 波高区分別の1コース勝率

| 波高範囲 | レース数 | 1コース勝率 | 差分 |
|----------|----------|-------------|------|
| 0-2cm | 3,003 | 57.7% | +1.4pt |
| 3-5cm | 2,691 | 55.1% | -1.3pt |
| 6-9cm | 630 | 53.6% | -2.8pt |
| **10-14cm** | 155 | **40.3%** | **-16.1pt** |
| 15-19cm | 99 | 51.0% | -5.4pt |
| 20cm+ | 75 | 47.3% | -9.1pt |

**重要**: 10-14cmが最も1コースに不利（-16.1pt）

#### コース別勝率の変化（10-14cm）

| コース | 通常 | 高波 | 差分 |
|--------|------|------|------|
| 1コース | 57.7% | 40.3% | -17.4pt |
| 2コース | 12.9% | 22.2% | +9.3pt |
| 3コース | 12.2% | 14.5% | +2.3pt |
| 4コース | 9.6% | 14.8% | +5.2pt |

→ **1コースから2コースへのシフト**が顕著

#### 会場別分析（10cm+）

| 会場 | レース数 | 1コース勝率 | 差分 |
|------|----------|-------------|------|
| 03（江戸川） | 314 | 45.0% | -11.4pt |
| 10（桐生） | 15 | 46.7% | -9.7pt |

→ 会場間の差は小さい（1.7pt）

### 2.3 実装方針

**採用**: 波高のみのシンプル補正

```python
def calculate_wave_height_adjustment(course, wave_height):
    if course == 1:
        if 10 <= wave_height < 15:
            return -8.0  # 10-14cm: 大幅不利
        elif wave_height >= 15:
            return -3.5  # 15cm以上: やや不利
    elif course == 2:
        if 10 <= wave_height < 15:
            return +5.0  # 10-14cm: 有利
        elif wave_height >= 15:
            return +2.0  # 15cm以上: やや有利
    return 0.0
```

**適用条件**:
- 波高: 10cm以上
- 対象コース: 1-2コース
- スコア換算: 差分の約50%を適用

**不採用の理由**（会場×波高補正）:
- 江戸川が高波レースの94.6%（314/332）を占め、会場特性の分析が困難
- 会場間の差が小さい（江戸川-11.4pt vs 桐生-9.7pt）
- 会場依存性が弱く、波高自体の影響が支配的

---

## 3. 実装状況

### 3.1 実装ファイル

#### 風速×風向×会場補正

- [src/analysis/weather_venue_wind_adjuster_v2.py](../src/analysis/weather_venue_wind_adjuster_v2.py)
  - 15パターンの補正テーブル
  - `calculate_venue_wind_adjustment()` 関数

#### 波高補正

- [src/analysis/wave_height_adjuster.py](../src/analysis/wave_height_adjuster.py)
  - 波高区分別の補正ロジック
  - `calculate_wave_height_adjustment()` 関数

#### BeforeInfoScorerへの統合

- [src/analysis/beforeinfo_scorer.py](../src/analysis/beforeinfo_scorer.py)
  - `_calc_weather_score()` メソッドに統合
  - 優先順位: 風速×風向 > 波高 > 気温・水温 > 天候

### 3.2 補正スコアの範囲

| 補正種別 | 範囲 | 5点満点換算 |
|----------|------|-------------|
| 風速×風向×会場 | -20.0 ~ +20.0点 | -10.0 ~ +10.0点 |
| 波高 | -10.0 ~ +5.0点 | -5.0 ~ +2.5点 |
| 気温・水温（補助） | -3.0 ~ +3.0点 | -1.5 ~ +1.5点 |
| 天候（補助） | -2.0 ~ +2.0点 | -1.0 ~ +1.0点 |

**合計最大範囲**: -30.0 ~ +20.0点（5点満点換算で-15.0 ~ +10.0点）

---

## 4. 今後の課題

### 4.1 2-6コースの補正

現時点では1コース中心の補正。2-6コースの補正も検討の余地あり。

**波高のケース**:
- 2コースは10-14cmで+9.3pt（+5.0点に補正済み）
- 3-4コースも若干有利になるが、影響度が小さい

**風速×風向のケース**:
- 戸田×北風: 2コースが41.7%（+28.8pt）
- 2-6コースへの補正も検討可能

### 4.2 データ蓄積

- 2026年以降もデータを蓄積
- サンプル数が少ない会場×風向の組み合わせを充実化
- 最低サンプル数を10件以上に引き上げ

### 4.3 強風時（6-8m）の補正

現在は暴風時（8m+）のみ。強風時（6-8m）の補正も検討。

### 4.4 波高×風速の複合効果

波高と風速が同時に高い場合の複合効果は未検証。

### 4.5 季節性の考慮

冬季と夏季で風・波の影響が異なる可能性あり。

---

## 5. 参考資料

### 分析スクリプト

- [scripts/analyze_weather_comprehensive_fulldata.py](../scripts/analyze_weather_comprehensive_fulldata.py) - 風速×風向×会場の分析
- [scripts/create_venue_wind_table.py](../scripts/create_venue_wind_table.py) - 補正テーブル生成
- [scripts/analyze_key_venue_wind_patterns.py](../scripts/analyze_key_venue_wind_patterns.py) - 主要6パターンの詳細分析
- [scripts/analyze_wave_height_venue.py](../scripts/analyze_wave_height_venue.py) - 会場別波高分析
- [scripts/analyze_wave_height_detailed.py](../scripts/analyze_wave_height_detailed.py) - 波高詳細分析

### ドキュメント

- [docs/weather_venue_wind_implementation_summary.md](weather_venue_wind_implementation_summary.md) - 風速×風向×会場補正の実装サマリー
- [docs/wave_height_implementation_summary.md](wave_height_implementation_summary.md) - 波高補正の実装サマリー
- [docs/weather_comprehensive_analysis_fulldata.md](weather_comprehensive_analysis_fulldata.md) - 通年データ分析レポート

---

## 6. まとめ

### 実装完了

2025年通年データ（17,407レース）に基づき、以下の気象補正を実装:

1. **会場×風向×風速補正**: 暴風時（8m+）×1コース、15パターン、±20点
2. **波高補正**: 高波時（10cm+）×1-2コース、±10点

### 効果

- **暴風時の会場特性を考慮**: 最大±20点の補正により、極端なパターンを適切に評価
- **高波時のコース有利不利を考慮**: 1コース不利、2コース有利を定量化
- **実データドリブン**: 追い風・向かい風の概念ではなく、実データに基づく補正

### 補正の優先順位

1. 会場×風向×風速（最優先、極端な影響）
2. 波高（優先、明確な影響）
3. 気温・水温（補助的）
4. 天候（補助的）

**気象情報の予測への統合が完了しました。**
